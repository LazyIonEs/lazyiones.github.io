<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>Android CameraXçš„åŸºæœ¬ä½¿ç”¨ | LazyIonEs</title><meta name="author" content="LazyIonEs"><meta name="copyright" content="LazyIonEs"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="å‰è¨€è™½ç„¶ç½‘ä¸Šæœ‰å¾ˆå¤šCameraXçš„æ•™ç¨‹ï¼Œä½†æ˜¯æ¯æ¬¡ç”¨CameraXçš„æ—¶å€™æ€»è¦åœ¨ç¿»ä¸€ç¿»å®˜æ–¹çš„æ–‡æ¡£æˆ–è€…ç½‘ä¸Šçš„æ•™ç¨‹ä¹‹ç±»çš„ï¼Œè¿™æ¬¡å°±è‡ªå·±è®°ä¸€ä¸‹å§ï¼Œç¿»è‡ªå·±çš„æ€»æ¯”ç¿»åˆ«äººçš„å¥½å§ğŸ¤ª å£°æ˜ä¾èµ–é¡¹è¦æ·»åŠ  CameraX çš„ä¾èµ–é¡¹ï¼Œæ‚¨å¿…é¡»å°† Google Maven ä»£ç åº“æ·»åŠ åˆ°é¡¹ç›®ä¸­ã€‚ æ‰“å¼€é¡¹ç›®çš„ settings.gradle æ–‡ä»¶å¹¶æ·»åŠ  google() ä»£ç åº“ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š GroovyKotlin1234567d">
<meta property="og:type" content="article">
<meta property="og:title" content="Android CameraXçš„åŸºæœ¬ä½¿ç”¨">
<meta property="og:url" content="https://blog.lazyiones.top/post/ff52020d.html">
<meta property="og:site_name" content="LazyIonEs">
<meta property="og:description" content="å‰è¨€è™½ç„¶ç½‘ä¸Šæœ‰å¾ˆå¤šCameraXçš„æ•™ç¨‹ï¼Œä½†æ˜¯æ¯æ¬¡ç”¨CameraXçš„æ—¶å€™æ€»è¦åœ¨ç¿»ä¸€ç¿»å®˜æ–¹çš„æ–‡æ¡£æˆ–è€…ç½‘ä¸Šçš„æ•™ç¨‹ä¹‹ç±»çš„ï¼Œè¿™æ¬¡å°±è‡ªå·±è®°ä¸€ä¸‹å§ï¼Œç¿»è‡ªå·±çš„æ€»æ¯”ç¿»åˆ«äººçš„å¥½å§ğŸ¤ª å£°æ˜ä¾èµ–é¡¹è¦æ·»åŠ  CameraX çš„ä¾èµ–é¡¹ï¼Œæ‚¨å¿…é¡»å°† Google Maven ä»£ç åº“æ·»åŠ åˆ°é¡¹ç›®ä¸­ã€‚ æ‰“å¼€é¡¹ç›®çš„ settings.gradle æ–‡ä»¶å¹¶æ·»åŠ  google() ä»£ç åº“ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š GroovyKotlin1234567d">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://blog.lazyiones.top/img/cover/img_cover_1.png">
<meta property="article:published_time" content="2023-08-14T11:31:06.000Z">
<meta property="article:modified_time" content="2023-09-01T06:57:42.182Z">
<meta property="article:author" content="LazyIonEs">
<meta property="article:tag" content="Android">
<meta property="article:tag" content="CameraX">
<meta property="article:tag" content="Jetpack">
<meta property="article:tag" content="ç›¸æœº">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://blog.lazyiones.top/img/cover/img_cover_1.png"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="https://blog.lazyiones.top/post/ff52020d.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":false,"top_n_per_article":1,"unescape":false,"languages":{"hits_empty":"æ‰¾ä¸åˆ°æ‚¨æŸ¥è¯¢çš„å†…å®¹ï¼š${query}","hits_stats":"å…±æ‰¾åˆ° ${hits} ç¯‡æ–‡ç« "}},
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":230},
  copy: {
    success: 'å¤åˆ¶æˆåŠŸ',
    error: 'å¤åˆ¶é”™è¯¯',
    noSupport: 'æµè§ˆå™¨ä¸æ”¯æŒ'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: 'åˆšåˆš',
    min: 'åˆ†é’Ÿå‰',
    hour: 'å°æ—¶å‰',
    day: 'å¤©å‰',
    month: 'ä¸ªæœˆå‰'
  },
  copyright: undefined,
  lightbox: 'mediumZoom',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid/dist/infinitegrid.min.js',
    buttonText: 'åŠ è½½æ›´å¤š'
  },
  isPhotoFigcaption: false,
  islazyload: true,
  isAnchor: true,
  percent: {
    toc: true,
    rightside: true,
  },
  autoDarkmode: true
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'Android CameraXçš„åŸºæœ¬ä½¿ç”¨',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2023-09-01 14:57:42'
}</script><script>(win=>{
      win.saveToLocal = {
        set: (key, value, ttl) => {
          if (ttl === 0) return
          const now = Date.now()
          const expiry = now + ttl * 86400000
          const item = {
            value,
            expiry
          }
          localStorage.setItem(key, JSON.stringify(item))
        },
      
        get: key => {
          const itemStr = localStorage.getItem(key)
      
          if (!itemStr) {
            return undefined
          }
          const item = JSON.parse(itemStr)
          const now = Date.now()
      
          if (now > item.expiry) {
            localStorage.removeItem(key)
            return undefined
          }
          return item.value
        }
      }
    
      win.getScript = (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        script.onerror = reject
        script.onload = script.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          script.onload = script.onreadystatechange = null
          resolve()
        }

        Object.keys(attr).forEach(key => {
          script.setAttribute(key, attr[key])
        })

        document.head.appendChild(script)
      })
    
      win.getCSS = (url, id = false) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onerror = reject
        link.onload = link.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          link.onload = link.onreadystatechange = null
          resolve()
        }
        document.head.appendChild(link)
      })
    
      win.activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          const isDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches
          const isLightMode = window.matchMedia('(prefers-color-scheme: light)').matches
          const isNotSpecified = window.matchMedia('(prefers-color-scheme: no-preference)').matches
          const hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

          if (t === undefined) {
            if (isLightMode) activateLightMode()
            else if (isDarkMode) activateDarkMode()
            else if (isNotSpecified || hasNoSupport) {
              const now = new Date()
              const hour = now.getHours()
              const isNight = hour <= 8 || hour >= 22
              isNight ? activateDarkMode() : activateLightMode()
            }
            window.matchMedia('(prefers-color-scheme: dark)').addListener(e => {
              if (saveToLocal.get('theme') === undefined) {
                e.matches ? activateDarkMode() : activateLightMode()
              }
            })
          } else if (t === 'light') activateLightMode()
          else activateDarkMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
      const detectApple = () => {
        if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
          document.documentElement.classList.add('apple')
        }
      }
      detectApple()
    })(window)</script><link rel="stylesheet" href="/css/custom.css"><meta name="generator" content="Hexo 6.3.0"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src= "/img/loading.gif" data-lazy-src="/img/avatar.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">æ–‡ç« </div><div class="length-num">7</div></a><a href="/tags/"><div class="headline">æ ‡ç­¾</div><div class="length-num">12</div></a><a href="/categories/"><div class="headline">åˆ†ç±»</div><div class="length-num">10</div></a></div><hr class="custom-hr"/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> é¦–é¡µ</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> æ—¶é—´è½´</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> æ ‡ç­¾</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> åˆ†ç±»</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fa fa-heartbeat"></i><span> å¨±ä¹</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/Gallery/"><i class="fa-fw fas fa-images"></i><span> ç›¸å†Œ</span></a></li><li><a class="site-page child" href="/bangumis/"><i class="fa-fw fa-brands fa-youtube"></i><span> ç•ªå‰§</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> å…³äº</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('/img/top_banner_2.png')"><nav id="nav"><span id="blog-info"><a href="/" title="LazyIonEs"><span class="site-name">LazyIonEs</span></a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search" href="javascript:void(0);"><i class="fas fa-search fa-fw"></i><span> æœç´¢</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> é¦–é¡µ</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> æ—¶é—´è½´</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> æ ‡ç­¾</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> åˆ†ç±»</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fa fa-heartbeat"></i><span> å¨±ä¹</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/Gallery/"><i class="fa-fw fas fa-images"></i><span> ç›¸å†Œ</span></a></li><li><a class="site-page child" href="/bangumis/"><i class="fa-fw fa-brands fa-youtube"></i><span> ç•ªå‰§</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> å…³äº</span></a></div></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">Android CameraXçš„åŸºæœ¬ä½¿ç”¨</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">å‘è¡¨äº</span><time class="post-meta-date-created" datetime="2023-08-14T11:31:06.000Z" title="å‘è¡¨äº 2023-08-14 19:31:06">2023-08-14</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">æ›´æ–°äº</span><time class="post-meta-date-updated" datetime="2023-09-01T06:57:42.182Z" title="æ›´æ–°äº 2023-09-01 14:57:42">2023-09-01</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/Android/">Android</a><i class="fas fa-angle-right post-meta-separator"></i><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/Android/CameraX/">CameraX</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">å­—æ•°æ€»è®¡:</span><span class="word-count">8.9k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">é˜…è¯»æ—¶é•¿:</span><span>31åˆ†é’Ÿ</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="Android CameraXçš„åŸºæœ¬ä½¿ç”¨"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">é˜…è¯»é‡:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span><span class="post-meta-separator">|</span><span class="post-meta-commentcount"><i class="far fa-comments fa-fw post-meta-icon"></i><span class="post-meta-label">è¯„è®ºæ•°:</span><a href="/post/ff52020d.html#post-comment"><span class="waline-comment-count" data-path="/post/ff52020d.html"><i class="fa-solid fa-spinner fa-spin"></i></span></a></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>è™½ç„¶ç½‘ä¸Šæœ‰å¾ˆå¤š<code>CameraX</code>çš„æ•™ç¨‹ï¼Œä½†æ˜¯æ¯æ¬¡ç”¨<code>CameraX</code>çš„æ—¶å€™æ€»è¦åœ¨ç¿»ä¸€ç¿»å®˜æ–¹çš„æ–‡æ¡£æˆ–è€…ç½‘ä¸Šçš„æ•™ç¨‹ä¹‹ç±»çš„ï¼Œè¿™æ¬¡å°±è‡ªå·±è®°ä¸€ä¸‹å§ï¼Œç¿»è‡ªå·±çš„æ€»æ¯”ç¿»åˆ«äººçš„å¥½å§ğŸ¤ª</p>
<h2 id="å£°æ˜ä¾èµ–é¡¹"><a href="#å£°æ˜ä¾èµ–é¡¹" class="headerlink" title="å£°æ˜ä¾èµ–é¡¹"></a>å£°æ˜ä¾èµ–é¡¹</h2><p>è¦æ·»åŠ  CameraX çš„ä¾èµ–é¡¹ï¼Œæ‚¨å¿…é¡»å°† <a target="_blank" rel="noopener" href="https://developer.android.google.cn/studio/build/dependencies?hl=zh-cn#google-maven">Google Maven ä»£ç åº“</a>æ·»åŠ åˆ°é¡¹ç›®ä¸­ã€‚</p>
<p>æ‰“å¼€é¡¹ç›®çš„ <code>settings.gradle</code> æ–‡ä»¶å¹¶æ·»åŠ  <code>google()</code> ä»£ç åº“ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<div class="tabs" id="æ·»åŠ -`google()`"><ul class="nav-tabs"><button type="button" class="tab  active" data-href="æ·»åŠ -`google()`-1">Groovy</button><button type="button" class="tab " data-href="æ·»åŠ -`google()`-2">Kotlin</button></ul><div class="tab-contents"><div class="tab-item-content active" id="æ·»åŠ -`google()`-1"><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">dependencyResolutionManagement &#123;</span><br><span class="line">    repositoriesMode.set(RepositoriesMode.FAIL_ON_PROJECT_REPOS)</span><br><span class="line">    repositories &#123;</span><br><span class="line">        google()</span><br><span class="line">        mavenCentral()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><div class="tab-item-content" id="æ·»åŠ -`google()`-2"><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">dependencyResolutionManagement &#123;</span><br><span class="line">    repositoriesMode.<span class="keyword">set</span>(RepositoriesMode.FAIL_ON_PROJECT_REPOS)</span><br><span class="line">    repositories &#123;</span><br><span class="line">        google()</span><br><span class="line">        mavenCentral()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></div><div class="tab-to-top"><button type="button" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div>

<p>å°†ä»¥ä¸‹å†…å®¹æ·»åŠ åˆ° Android ä»£ç å—çš„æœ«å°¾ï¼š</p>
<div class="tabs" id="æ·»åŠ -jvmtarget"><ul class="nav-tabs"><button type="button" class="tab  active" data-href="æ·»åŠ -jvmtarget-1">Groovy</button><button type="button" class="tab " data-href="æ·»åŠ -jvmtarget-2">Kotlin</button></ul><div class="tab-contents"><div class="tab-item-content active" id="æ·»åŠ -jvmtarget-1"><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">android &#123;</span><br><span class="line">    compileOptions &#123;</span><br><span class="line">        sourceCompatibility JavaVersion.VERSION_1_8</span><br><span class="line">        targetCompatibility JavaVersion.VERSION_1_8</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// For Kotlin projects</span></span><br><span class="line">    kotlinOptions &#123;</span><br><span class="line">        jvmTarget = <span class="string">&quot;1.8&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><div class="tab-item-content" id="æ·»åŠ -jvmtarget-2"><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">android &#123;</span><br><span class="line">    compileOptions &#123;</span><br><span class="line">        sourceCompatibility = JavaVersion.VERSION_1_8</span><br><span class="line">        targetCompatibility = JavaVersion.VERSION_1_8</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// For Kotlin projects</span></span><br><span class="line">    kotlinOptions &#123;</span><br><span class="line">        jvmTarget = <span class="string">&quot;1.8&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></div><div class="tab-to-top"><button type="button" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div>

<p>å°†ä»¥ä¸‹å†…å®¹æ·»åŠ åˆ°åº”ç”¨çš„æ¯ä¸ªæ¨¡å—çš„ <code>build.gradle</code> æ–‡ä»¶ä¸­ï¼š</p>
<div class="tabs" id="æ·»åŠ -`build.gradle`"><ul class="nav-tabs"><button type="button" class="tab  active" data-href="æ·»åŠ -`build.gradle`-1">Groovy</button><button type="button" class="tab " data-href="æ·»åŠ -`build.gradle`-2">Kotlin</button></ul><div class="tab-contents"><div class="tab-item-content active" id="æ·»åŠ -`build.gradle`-1"><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">dependencies &#123;</span><br><span class="line">  <span class="comment">// CameraXæ ¸å¿ƒåº“ä½¿ç”¨camera2å®ç°</span></span><br><span class="line">  <span class="keyword">def</span> camerax_version = <span class="string">&quot;1.2.3&quot;</span></span><br><span class="line">  <span class="comment">// ä»¥ä¸‹è¡Œæ˜¯å¯é€‰çš„ï¼Œå› ä¸ºæ ¸å¿ƒåº“æ˜¯ç”±camera-camera2é—´æ¥åŒ…å«çš„</span></span><br><span class="line">  implementation <span class="string">&quot;androidx.camera:camera-core:$&#123;camerax_version&#125;&quot;</span></span><br><span class="line">  implementation <span class="string">&quot;androidx.camera:camera-camera2:$&#123;camerax_version&#125;&quot;</span></span><br><span class="line">  <span class="comment">// å¦‚æœæ‚¨æƒ³å¦å¤–ä½¿ç”¨ CameraX Lifecycle åº“</span></span><br><span class="line">  implementation <span class="string">&quot;androidx.camera:camera-lifecycle:$&#123;camerax_version&#125;&quot;</span></span><br><span class="line">  <span class="comment">// å¦‚æœæ‚¨æƒ³å¦å¤–ä½¿ç”¨ CameraX VideoCapture åº“</span></span><br><span class="line">  implementation <span class="string">&quot;androidx.camera:camera-video:$&#123;camerax_version&#125;&quot;</span></span><br><span class="line">  <span class="comment">// å¦‚æœæ‚¨æƒ³å¦å¤–ä½¿ç”¨ CameraX View ç±»</span></span><br><span class="line">  implementation <span class="string">&quot;androidx.camera:camera-view:$&#123;camerax_version&#125;&quot;</span></span><br><span class="line">  <span class="comment">// å¦‚æœæ‚¨æƒ³å¦å¤–æ·»åŠ  CameraX ML Kit Vision Integration</span></span><br><span class="line">  implementation <span class="string">&quot;androidx.camera:camera-mlkit-vision:$&#123;camerax_version&#125;&quot;</span></span><br><span class="line">  <span class="comment">// å¦‚æœæ‚¨æƒ³å¦å¤–ä½¿ç”¨ CameraX Extensions åº“</span></span><br><span class="line">  implementation <span class="string">&quot;androidx.camera:camera-extensions:$&#123;camerax_version&#125;&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><div class="tab-item-content" id="æ·»åŠ -`build.gradle`-2"><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">dependencies &#123;</span><br><span class="line">    <span class="comment">// CameraXæ ¸å¿ƒåº“ä½¿ç”¨camera2å®ç°</span></span><br><span class="line">    <span class="keyword">val</span> camerax_version = <span class="string">&quot;1.2.3&quot;</span></span><br><span class="line">    <span class="comment">// ä»¥ä¸‹è¡Œæ˜¯å¯é€‰çš„ï¼Œå› ä¸ºæ ¸å¿ƒåº“æ˜¯ç”±camera-camera2é—´æ¥åŒ…å«çš„</span></span><br><span class="line">    implementation(<span class="string">&quot;androidx.camera:camera-core:<span class="subst">$&#123;camerax_version&#125;</span>&quot;</span>)</span><br><span class="line">    implementation(<span class="string">&quot;androidx.camera:camera-camera2:<span class="subst">$&#123;camerax_version&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="comment">// å¦‚æœæ‚¨æƒ³å¦å¤–ä½¿ç”¨ CameraX Lifecycle åº“</span></span><br><span class="line">    implementation(<span class="string">&quot;androidx.camera:camera-lifecycle:<span class="subst">$&#123;camerax_version&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="comment">// å¦‚æœæ‚¨æƒ³å¦å¤–ä½¿ç”¨ CameraX VideoCapture åº“</span></span><br><span class="line">    implementation(<span class="string">&quot;androidx.camera:camera-video:<span class="subst">$&#123;camerax_version&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="comment">// å¦‚æœæ‚¨æƒ³å¦å¤–ä½¿ç”¨ CameraX View ç±»</span></span><br><span class="line">    implementation(<span class="string">&quot;androidx.camera:camera-view:<span class="subst">$&#123;camerax_version&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="comment">// å¦‚æœæ‚¨æƒ³å¦å¤–æ·»åŠ  CameraX ML Kit Vision Integration</span></span><br><span class="line">    implementation(<span class="string">&quot;androidx.camera:camera-mlkit-vision:<span class="subst">$&#123;camerax_version&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="comment">// å¦‚æœæ‚¨æƒ³å¦å¤–ä½¿ç”¨ CameraX Extensions åº“</span></span><br><span class="line">    implementation(<span class="string">&quot;androidx.camera:camera-extensions:<span class="subst">$&#123;camerax_version&#125;</span>&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></div><div class="tab-to-top"><button type="button" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div>

<p>å¦‚éœ€è¯¦ç»†äº†è§£å¦‚ä½•é…ç½®åº”ç”¨ä»¥æ»¡è¶³ä¸Šè¿°è¦æ±‚æˆ–æŸ¥çœ‹CameraXæœ€æ–°ç‰ˆæœ¬å·ï¼Œè¯·å‚é˜…<a target="_blank" rel="noopener" href="https://developer.android.google.cn/jetpack/androidx/releases/camera">å£°æ˜ä¾èµ–é¡¹</a>ã€‚</p>
<h2 id="å®ç°é¢„è§ˆ"><a href="#å®ç°é¢„è§ˆ" class="headerlink" title="å®ç°é¢„è§ˆ"></a>å®ç°é¢„è§ˆ</h2><p>åœ¨å‘åº”ç”¨æ·»åŠ é¢„è§ˆæ—¶ï¼Œè¯·ä½¿ç”¨ <a target="_blank" rel="noopener" href="https://developer.android.google.cn/reference/kotlin/androidx/camera/view/PreviewView?hl=zh-cn"><code>PreviewView</code></a>ï¼Œè¿™æ˜¯ä¸€ç§å¯ä»¥å‰ªè£ã€ç¼©æ”¾å’Œæ—‹è½¬ä»¥ç¡®ä¿æ­£ç¡®æ˜¾ç¤ºçš„ <code>View</code>ã€‚</p>
<p>å½“ç›¸æœºå¤„äºæ´»åŠ¨çŠ¶æ€æ—¶ï¼Œå›¾ç‰‡é¢„è§ˆä¼šæµå¼ä¼ è¾“åˆ° <code>PreviewView</code> ä¸­çš„ Surfaceã€‚</p>
<h3 id="å°†-PreviewView-æ·»åŠ åˆ°å¸ƒå±€"><a href="#å°†-PreviewView-æ·»åŠ åˆ°å¸ƒå±€" class="headerlink" title="å°† PreviewView æ·»åŠ åˆ°å¸ƒå±€"></a>å°† PreviewView æ·»åŠ åˆ°å¸ƒå±€</h3><p>ä»¥ä¸‹ç¤ºä¾‹æ˜¾ç¤ºäº†å¸ƒå±€ä¸­çš„ <code>PreviewView</code>ï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">FrameLayout</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:id</span>=<span class="string">&quot;@+id/container&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">androidx.camera.view.PreviewView</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:id</span>=<span class="string">&quot;@+id/previewView&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">FrameLayout</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="åˆå§‹åŒ–ç›¸æœº"><a href="#åˆå§‹åŒ–ç›¸æœº" class="headerlink" title="åˆå§‹åŒ–ç›¸æœº"></a>åˆå§‹åŒ–ç›¸æœº</h3><p>ä»¥ä¸‹ä»£ç å±•ç¤ºäº†å¦‚ä½•åˆå§‹åŒ–é¢„è§ˆéœ€è¦ <code>CameraProvider</code>ï¼š</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> androidx.camera.lifecycle.ProcessCameraProvider</span><br><span class="line"><span class="keyword">import</span> com.google.common.util.concurrent.ListenableFuture</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">CameraActivity</span> : <span class="type">AppCompatActivity</span>() &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">lateinit</span> <span class="keyword">var</span> cameraProviderFuture : ListenableFuture&lt;ProcessCameraProvider&gt;</span><br><span class="line">  	<span class="keyword">private</span> <span class="keyword">var</span> cameraProvider: ProcessCameraProvider? = <span class="literal">null</span></span><br><span class="line">  </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * åˆå§‹åŒ–ç›¸æœºï¼Œå¯åœ¨onCreate()å†…è°ƒç”¨</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">fun</span> <span class="title">initCamera</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="comment">// æ£€æŸ¥æƒé™</span></span><br><span class="line">      	checkPermission() &#123;</span><br><span class="line">          	cameraProviderFuture = ProcessCameraProvider.getInstance(<span class="keyword">this</span>)</span><br><span class="line">          	cameraProviderFuture.addListener(&#123;</span><br><span class="line">                cameraProvider = cameraProviderFuture.<span class="keyword">get</span>()</span><br><span class="line">            		<span class="comment">// æ£€æŸ¥æ‘„åƒå¤´</span></span><br><span class="line">                lensFacing = <span class="keyword">when</span> &#123;</span><br><span class="line">                    hasBackCamera() -&gt; CameraSelector.LENS_FACING_BACK</span><br><span class="line">                    hasFrontCamera() -&gt; CameraSelector.LENS_FACING_FRONT</span><br><span class="line">                    <span class="keyword">else</span> -&gt; &#123;</span><br><span class="line">                        toast(<span class="string">&quot;å‰åæ‘„åƒå¤´ä¸å¯ç”¨&quot;</span>)</span><br><span class="line">                        <span class="keyword">return</span><span class="symbol">@addListener</span></span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            		<span class="comment">// (å¯å¿½ç•¥) å°†PreviewViewçš„é¢„è§ˆViewæ”¹ä¸ºTextureView</span></span><br><span class="line">                binding.previewView.implementationMode = PreviewView.ImplementationMode.COMPATIBLE</span><br><span class="line">                <span class="comment">// 	ç»‘å®šç›¸æœº</span></span><br><span class="line">                bindPreview(cameraProvider ?: <span class="keyword">return</span><span class="symbol">@addListener</span>)</span><br><span class="line">            &#125;, ContextCompat.getMainExecutor(requireContext()))</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="æ£€æŸ¥æ‘„åƒå¤´"><a href="#æ£€æŸ¥æ‘„åƒå¤´" class="headerlink" title="æ£€æŸ¥æ‘„åƒå¤´"></a>æ£€æŸ¥æ‘„åƒå¤´</h3><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** å¦‚æœè®¾å¤‡æœ‰å¯ç”¨çš„åç½®æ‘„åƒå¤´ï¼Œåˆ™è¿”å› trueã€‚å¦åˆ™ä¸ºå‡ */</span></span><br><span class="line"><span class="keyword">private</span> <span class="function"><span class="keyword">fun</span> <span class="title">hasBackCamera</span><span class="params">()</span></span>: <span class="built_in">Boolean</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> cameraProvider?.hasCamera(CameraSelector.DEFAULT_BACK_CAMERA) ?: <span class="literal">false</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/** å¦‚æœè®¾å¤‡æœ‰å¯ç”¨çš„å‰ç½®æ‘„åƒå¤´ï¼Œåˆ™è¿”å› trueã€‚å¦åˆ™ä¸ºå‡ */</span></span><br><span class="line"><span class="keyword">private</span> <span class="function"><span class="keyword">fun</span> <span class="title">hasFrontCamera</span><span class="params">()</span></span>: <span class="built_in">Boolean</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> cameraProvider?.hasCamera(CameraSelector.DEFAULT_FRONT_CAMERA) ?: <span class="literal">false</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="ç»‘å®šç›¸æœº"><a href="#ç»‘å®šç›¸æœº" class="headerlink" title="ç»‘å®šç›¸æœº"></a>ç»‘å®šç›¸æœº</h3><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Camera</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">var</span> camera: Camera? = <span class="literal">null</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// åˆ›å»ºPreview</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">val</span> preview <span class="keyword">by</span> lazy &#123;</span><br><span class="line">		Preview.Builder().build()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å½“å‰æ‘„åƒå¤´</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">var</span> lensFacing: <span class="built_in">Int</span> = CameraSelector.LENS_FACING_BACK</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ç»‘å®šç›¸æœº</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">private</span> <span class="function"><span class="keyword">fun</span> <span class="title">bindPreview</span><span class="params">(cameraProvider: <span class="type">ProcessCameraProvider</span>)</span></span> &#123;</span><br><span class="line">    <span class="comment">// é€‰æ‹©æ‘„åƒå¤´</span></span><br><span class="line">		<span class="keyword">val</span> cameraSelector = CameraSelector.Builder().requireLensFacing(lensFacing).build()</span><br><span class="line">		<span class="comment">// è§£é™¤æ‰€æœ‰ç»‘å®š</span></span><br><span class="line">		cameraProvider.unbindAll()</span><br><span class="line">		<span class="comment">// å°†æ‰€é€‰ç›¸æœºå’Œä»»æ„ç”¨ä¾‹ç»‘å®šåˆ°ç”Ÿå‘½å‘¨æœŸ</span></span><br><span class="line">		camera = cameraProvider.bindToLifecycle(<span class="keyword">this</span>, cameraSelector, preview)</span><br><span class="line">		<span class="comment">// å°† Preview è¿æ¥åˆ° PreviewView</span></span><br><span class="line">		preview.setSurfaceProvider(binding.previewView.surfaceProvider)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¯·æ³¨æ„ï¼Œ<a target="_blank" rel="noopener" href="https://developer.android.google.cn/reference/androidx/camera/lifecycle/ProcessCameraProvider#bindToLifecycle(androidx.lifecycle.LifecycleOwner,%20androidx.camera.core.CameraSelector,%20androidx.camera.core.UseCase...)"><code>bindToLifecycle()</code></a> ä¼šè¿”å›ä¸€ä¸ª <a target="_blank" rel="noopener" href="https://developer.android.google.cn/reference/androidx/camera/core/Camera?hl=zh-cn"><code>Camera</code></a> å¯¹è±¡ã€‚å¦‚éœ€è¯¦ç»†äº†è§£å¦‚ä½•æ§åˆ¶ç›¸æœºè¾“å‡ºï¼ˆä¾‹å¦‚å˜ç„¦å’Œæ›å…‰ï¼‰ï¼Œè¯·å‚é˜…<a target="_blank" rel="noopener" href="https://developer.android.google.cn/training/camerax/configuration?hl=zh-cn#camera-output">ç›¸æœºè¾“å‡º</a>ã€‚</p>
<h2 id="å›¾ç‰‡æ‹æ‘„"><a href="#å›¾ç‰‡æ‹æ‘„" class="headerlink" title="å›¾ç‰‡æ‹æ‘„"></a>å›¾ç‰‡æ‹æ‘„</h2><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">val</span> imageCapture <span class="keyword">by</span> lazy &#123;</span><br><span class="line">		ImageCapture.Builder().setCaptureMode(ImageCapture.CAPTURE_MODE_MAXIMIZE_QUALITY)</span><br><span class="line">				.setTargetAspectRatio(AspectRatio.RATIO_4_3).build()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ–¹å‘</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">var</span> orientationEventListener: OrientationEventListener? = <span class="literal">null</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>åœ¨<code>cameraProviderFuture.addListener</code>å†…éƒ¨æ·»åŠ  è°ƒç”¨<code>bindPreview() </code>æ–¹æ³•ä¹‹å‰</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">orientationEventListener = <span class="keyword">object</span> : OrientationEventListener(<span class="keyword">this</span>) &#123;</span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onOrientationChanged</span><span class="params">(orientation: <span class="type">Int</span>)</span></span> &#123; <span class="comment">// Monitors orientation values to determine the target rotation value</span></span><br><span class="line">        <span class="keyword">val</span> rotation = <span class="keyword">when</span> (orientation) &#123;</span><br><span class="line">            <span class="keyword">in</span> <span class="number">45.</span><span class="number">.134</span> -&gt; Surface.ROTATION_270</span><br><span class="line">            <span class="keyword">in</span> <span class="number">135.</span><span class="number">.224</span> -&gt; Surface.ROTATION_180</span><br><span class="line">            <span class="keyword">in</span> <span class="number">225.</span><span class="number">.314</span> -&gt; Surface.ROTATION_90</span><br><span class="line">            <span class="keyword">else</span> -&gt; Surface.ROTATION_0</span><br><span class="line">        &#125;</span><br><span class="line">        imageCapture.targetRotation = rotation</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>åœ¨bindPreview()æ–¹æ³•å†…å¯ç”¨<br><code>orientationEventListener?.enable()</code></p>
<p>åŠæ—¶æš‚åœ</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onPause</span><span class="params">()</span></span> &#123;</span><br><span class="line">    orientationEventListener?.disable()</span><br><span class="line">    <span class="keyword">super</span>.onPause()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>åœ¨<code>bindToLifecycle</code>å†…åŠ å…¥<code>UseCase</code></p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">camera = cameraProvider.bindToLifecycle(viewLifecycleOwner, cameraSelector, preview, imageCapture)</span><br></pre></td></tr></table></figure>

<p>æ‹ç…§</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ‹ç…§</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@SuppressLint(<span class="string">&quot;RestrictedApi&quot;</span>)</span></span><br><span class="line"><span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">takePicture</span><span class="params">(save: (<span class="type">uri</span>: <span class="type">Uri</span>?) -&gt; <span class="type">Unit</span>)</span></span> &#123;</span><br><span class="line">    <span class="comment">// å­˜å‚¨ç…§ç‰‡çš„è·¯å¾„</span></span><br><span class="line">    <span class="keyword">val</span> dir = File(ConfigConstant.PATH)</span><br><span class="line">    <span class="keyword">if</span> (!dir.exists()) dir.mkdirs()</span><br><span class="line">    <span class="keyword">val</span> srcFile = File(dir, ConfigConstant.BITMAP_NAME)</span><br><span class="line">    <span class="keyword">val</span> outputFileOptions = ImageCapture.OutputFileOptions.Builder(srcFile).build()</span><br><span class="line">    imageCapture.takePicture(outputFileOptions, cameraExecutor, <span class="keyword">object</span> : ImageCapture.OnImageSavedCallback &#123;</span><br><span class="line">        <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onImageSaved</span><span class="params">(outputFileResults: <span class="type">ImageCapture</span>.<span class="type">OutputFileResults</span>)</span></span> &#123;</span><br><span class="line">            save(outputFileResults?.savedUri)</span><br><span class="line">            <span class="comment">// outputFileResultså¯ä»¥æ‹¿åˆ°å›¾ç‰‡çš„Uri</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onError</span><span class="params">(exception: <span class="type">ImageCaptureException</span>)</span></span> &#123;</span><br><span class="line">            save(<span class="literal">null</span>)</span><br><span class="line">            toast(<span class="string">&quot;æ‹ç…§å¼‚å¸¸&quot;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>åˆ°è¿™é‡ŒåŸºæœ¬ä¸Šå°±èƒ½å®ç°æ­£å¸¸çš„æ‹æ‘„ï¼Œå†æ¥ä»‹ç»ä¸€äº›å°åŠŸèƒ½å§</p>
<h2 id="éƒ¨åˆ†åŠŸèƒ½"><a href="#éƒ¨åˆ†åŠŸèƒ½" class="headerlink" title="éƒ¨åˆ†åŠŸèƒ½"></a>éƒ¨åˆ†åŠŸèƒ½</h2><h3 id="åˆ‡æ¢æ‘„åƒå¤´"><a href="#åˆ‡æ¢æ‘„åƒå¤´" class="headerlink" title="åˆ‡æ¢æ‘„åƒå¤´"></a>åˆ‡æ¢æ‘„åƒå¤´</h3><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * åˆ‡æ¢æ‘„åƒå¤´</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">switchCamera</span><span class="params">()</span></span> &#123;</span><br><span class="line">    orientationEventListener?.disable()</span><br><span class="line">    lensFacing = <span class="keyword">if</span> (CameraSelector.LENS_FACING_FRONT == lensFacing) &#123;</span><br><span class="line">        CameraSelector.LENS_FACING_BACK</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        CameraSelector.LENS_FACING_FRONT</span><br><span class="line">    &#125;</span><br><span class="line">    bindPreview(cameraProvider ?: <span class="keyword">return</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="æ‰‹ç”µç­’"><a href="#æ‰‹ç”µç­’" class="headerlink" title="æ‰‹ç”µç­’"></a>æ‰‹ç”µç­’</h3><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * åˆ‡æ¢æ‰‹ç”µç­’,å¯èƒ½æ‰“å¼€å¤±è´¥</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">flashlight</span><span class="params">()</span></span>: <span class="built_in">Boolean</span> &#123;</span><br><span class="line">    camera?.let &#123;</span><br><span class="line">        <span class="keyword">val</span> mode = <span class="keyword">if</span> (imageCapture.flashMode == ImageCapture.FLASH_MODE_OFF) ImageCapture.FLASH_MODE_ON</span><br><span class="line">        <span class="keyword">else</span> ImageCapture.FLASH_MODE_OFF</span><br><span class="line">        imageCapture.flashMode = mode</span><br><span class="line">        <span class="keyword">return</span> imageCapture.flashMode == ImageCapture.FLASH_MODE_ON</span><br><span class="line">    &#125; ?: toast(<span class="string">&quot;é—ªå…‰ç¯å¼€å¯å¤±è´¥,è¯·æ£€æŸ¥ç›¸æœºèƒ½å¦æ­£å¸¸ä½¿ç”¨&quot;</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="æ›å…‰è¡¥å¿"><a href="#æ›å…‰è¡¥å¿" class="headerlink" title="æ›å…‰è¡¥å¿"></a>æ›å…‰è¡¥å¿</h3><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * è®¾ç½®æ›å…‰è¡¥å¿, å¯èƒ½è®¾ç½®å¤±è´¥</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">setExposureCompensationIndex</span><span class="params">(value: <span class="type">Int</span>)</span></span> &#123;</span><br><span class="line">    camera?.let &#123; camera -&gt;</span><br><span class="line">        <span class="keyword">val</span> cameraInfo = camera.cameraInfo</span><br><span class="line">        <span class="keyword">if</span> (cameraInfo.exposureState.exposureCompensationRange.upper == <span class="number">0</span> &amp;&amp; cameraInfo.exposureState.exposureCompensationRange.lower == <span class="number">0</span>) &#123;</span><br><span class="line">            toast(<span class="string">&quot;å½“å‰è®¾å¤‡ä¸æ”¯æŒè®¾ç½®æ›å…‰è¡¥å¿&quot;</span>)</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (cameraInfo.exposureState.exposureCompensationRange.contains(value)) &#123;</span><br><span class="line">            <span class="keyword">val</span> index = (value / camera.cameraInfo.exposureState.exposureCompensationStep.toFloat()).roundToInt()</span><br><span class="line">            camera.cameraControl.setExposureCompensationIndex(index)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; ?: toast(<span class="string">&quot;è®¾ç½®æ›å…‰è¡¥å¿å¤±è´¥,è¯·æ£€æŸ¥ç›¸æœºèƒ½å¦æ­£å¸¸ä½¿ç”¨&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä¸‹é¢çš„å†…å®¹æ¥æºäº<a target="_blank" rel="noopener" href="https://developer.android.google.cn/training/camerax">Androidå®˜ç½‘æ–‡æ¡£</a></p>
<h2 id="PreviewView-çš„å…¶ä»–API"><a href="#PreviewView-çš„å…¶ä»–API" class="headerlink" title="PreviewView çš„å…¶ä»–API"></a>PreviewView çš„å…¶ä»–API</h2><p>CameraX <code>PreviewView</code> æä¾›äº†ä¸€äº›å…¶ä»– API æ¥ç”¨äºé…ç½®å±æ€§ï¼Œä¾‹å¦‚ï¼š</p>
<ul>
<li>ç”¨äºæ¸²æŸ“é¢„è§ˆæµçš„<a target="_blank" rel="noopener" href="https://developer.android.google.cn/reference/androidx/camera/view/PreviewView.ImplementationMode?hl=zh-cn">å®ç°æ¨¡å¼</a>ã€‚</li>
<li>é¢„è§ˆå›¾ç‰‡çš„<a target="_blank" rel="noopener" href="https://developer.android.google.cn/reference/androidx/camera/view/PreviewView.ScaleType?hl=zh-cn">ç¼©æ”¾ç±»å‹</a>ã€‚</li>
</ul>
<h3 id="å®ç°æ¨¡å¼"><a href="#å®ç°æ¨¡å¼" class="headerlink" title="å®ç°æ¨¡å¼"></a>å®ç°æ¨¡å¼</h3><p><code>PreviewView</code> å¯ä»¥ä½¿ç”¨ä»¥ä¸‹æ¨¡å¼ä¹‹ä¸€å°†é¢„è§ˆæµæ¸²æŸ“åˆ°ç›®æ ‡ <code>View</code> ä¸Šï¼š</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://developer.android.google.cn/reference/androidx/camera/view/PreviewView.ImplementationMode?hl=zh-cn#PERFORMANCE"><code>PERFORMANCE</code></a> æ˜¯é»˜è®¤æ¨¡å¼ã€‚<code>PreviewView</code> ä¼šä½¿ç”¨ <a target="_blank" rel="noopener" href="https://developer.android.google.cn/reference/android/view/SurfaceView?hl=zh-cn"><code>SurfaceView</code></a> æ˜¾ç¤ºè§†é¢‘ä¸²æµï¼Œä½†åœ¨<a target="_blank" rel="noopener" href="https://developer.android.google.cn/reference/androidx/camera/view/PreviewView.ImplementationMode?hl=zh-cn#PERFORMANCE">æŸäº›æƒ…å†µä¸‹</a>ä¼šå›é€€ä¸ºä½¿ç”¨ <a target="_blank" rel="noopener" href="https://developer.android.google.cn/reference/android/view/TextureView?hl=zh-cn"><code>TextureView</code></a>ã€‚<code>SurfaceView</code> å…·æœ‰ä¸“ç”¨çš„ç»˜å›¾ç•Œé¢ï¼Œè¯¥å¯¹è±¡æ›´æœ‰å¯èƒ½é€šè¿‡<a target="_blank" rel="noopener" href="https://source.android.google.cn/devices/graphics/hwc?hl=zh-cn">å†…éƒ¨ç¡¬ä»¶åˆæˆå™¨</a>å®ç°ç¡¬ä»¶å åŠ å±‚ï¼Œå°¤å…¶æ˜¯å½“é¢„è§ˆè§†é¢‘ä¸Šé¢æ²¡æœ‰å…¶ä»–ç•Œé¢å…ƒç´ ï¼ˆå¦‚æŒ‰é’®ï¼‰æ—¶ã€‚é€šè¿‡ä½¿ç”¨ç¡¬ä»¶å åŠ å±‚è¿›è¡Œæ¸²æŸ“ï¼Œè§†é¢‘å¸§ä¼šé¿å¼€ GPU è·¯å¾„ï¼Œä»è€Œèƒ½é™ä½å¹³å°åŠŸè€—å¹¶ç¼©çŸ­å»¶è¿Ÿæ—¶é—´ã€‚</li>
<li><a target="_blank" rel="noopener" href="https://developer.android.google.cn/reference/androidx/camera/view/PreviewView.ImplementationMode?hl=zh-cn#COMPATIBLE"><code>COMPATIBLE</code></a> æ¨¡å¼ã€‚åœ¨æ­¤æ¨¡å¼ä¸‹ï¼Œ<code>PreviewView</code> ä¼šä½¿ç”¨ <code>TextureView</code>ï¼›ä¸åŒäº <code>SurfaceView</code>ï¼Œè¯¥å¯¹è±¡æ²¡æœ‰ä¸“ç”¨çš„ç»˜å›¾è¡¨é¢ã€‚å› æ­¤ï¼Œè§†é¢‘è¦é€šè¿‡æ··åˆæ¸²æŸ“ï¼Œæ‰èƒ½æ˜¾ç¤ºã€‚åœ¨è¿™ä¸ªé¢å¤–çš„æ­¥éª¤ä¸­ï¼Œåº”ç”¨å¯ä»¥æ‰§è¡Œé¢å¤–çš„å¤„ç†å·¥ä½œï¼Œä¾‹å¦‚ä¸å—é™åˆ¶åœ°ç¼©æ”¾å’Œæ—‹è½¬è§†é¢‘ã€‚</li>
</ul>
<p>æ‚¨å¯ä»¥ä½¿ç”¨ <a target="_blank" rel="noopener" href="https://developer.android.google.cn/reference/androidx/camera/view/PreviewView?hl=zh-cn#setImplementationMode(androidx.camera.view.PreviewView.ImplementationMode)"><code>PreviewView.setImplementationMode()</code></a> é€‰æ‹©é€‚åˆå…·ä½“åº”ç”¨çš„å®ç°æ¨¡å¼ã€‚å¦‚æœé»˜è®¤çš„ <code>PERFORMANCE</code> æ¨¡å¼ä¸é€‚åˆæ‚¨çš„åº”ç”¨ï¼Œè¯·å‚é˜…ä»¥ä¸‹ä»£ç ç¤ºä¾‹ï¼Œäº†è§£å¦‚ä½•è®¾ç½® <code>COMPATIBLE</code> æ¨¡å¼ï¼š</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// viewFinder æ˜¯ä¸€ä¸ª PreviewView å®ä¾‹</span></span><br><span class="line">viewFinder.implementationMode = PreviewView.ImplementationMode.COMPATIBLE</span><br></pre></td></tr></table></figure>

<h3 id="ç¼©æ”¾ç±»å‹"><a href="#ç¼©æ”¾ç±»å‹" class="headerlink" title="ç¼©æ”¾ç±»å‹"></a>ç¼©æ”¾ç±»å‹</h3><p>å½“é¢„è§ˆè§†é¢‘åˆ†è¾¨ç‡ä¸ç›®æ ‡ <code>PreviewView</code> çš„å°ºå¯¸ä¸åŒæ—¶ï¼Œè§†é¢‘å†…å®¹éœ€è¦é€šè¿‡å‰ªè£æ“ä½œæˆ–æ·»åŠ é®å¹…å¼é»‘è¾¹æ¥é€‚åº”è§†å›¾ï¼ˆä¿æŒåŸå§‹å®½é«˜æ¯”ï¼‰ã€‚ä¸ºæ­¤ï¼Œ<code>PreviewView</code> æä¾›äº†ä»¥ä¸‹ <a target="_blank" rel="noopener" href="https://developer.android.google.cn/reference/androidx/camera/view/PreviewView.ScaleType?hl=zh-cn"><code>ScaleTypes</code></a>ï¼š</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://developer.android.google.cn/reference/androidx/camera/view/PreviewView.ScaleType?hl=zh-cn#FIT_CENTER"><code>FIT_CENTER</code></a>ã€<a target="_blank" rel="noopener" href="https://developer.android.google.cn/reference/androidx/camera/view/PreviewView.ScaleType?hl=zh-cn#FIT_START"><code>FIT_START</code></a> å’Œ <a target="_blank" rel="noopener" href="https://developer.android.google.cn/reference/androidx/camera/view/PreviewView.ScaleType?hl=zh-cn#FIT_END"><code>FIT_END</code></a>ï¼Œç”¨äºæ·»åŠ é®å¹…å¼é»‘è¾¹ã€‚æ•´ä¸ªè§†é¢‘å†…å®¹ä¼šè°ƒæ•´ï¼ˆæ”¾å¤§æˆ–ç¼©å°ï¼‰ä¸ºå¯åœ¨ç›®æ ‡ <code>PreviewView</code> ä¸­æ˜¾ç¤ºçš„æœ€å¤§å°ºå¯¸ã€‚ä¸è¿‡ï¼Œè™½ç„¶æ•´ä¸ªè§†é¢‘å¸§ä¼šå®Œæ•´æ˜¾ç¤ºï¼Œä½†å±å¹•ç”»é¢ä¸­å¯èƒ½ä¼šå‡ºç°ç©ºç™½éƒ¨åˆ†ã€‚è§†é¢‘å¸§ä¼šä¸ç›®æ ‡è§†å›¾çš„ä¸­å¿ƒã€èµ·å§‹æˆ–ç»“æŸä½ç½®å¯¹é½ï¼Œå…·ä½“å–å†³äºæ‚¨åœ¨ä¸Šè¿°ä¸‰ç§ç¼©æ”¾ç±»å‹ä¸­é€‰æ‹©äº†å“ªä¸€ç§ã€‚</li>
<li><a target="_blank" rel="noopener" href="https://developer.android.google.cn/reference/androidx/camera/view/PreviewView.ScaleType?hl=zh-cn#FILL_CENTER"><code>FILL_CENTER</code></a>ã€<a target="_blank" rel="noopener" href="https://developer.android.google.cn/reference/androidx/camera/view/PreviewView.ScaleType?hl=zh-cn#FILL_START"><code>FILL_START</code></a> å’Œ <a target="_blank" rel="noopener" href="https://developer.android.google.cn/reference/androidx/camera/view/PreviewView.ScaleType?hl=zh-cn#FILL_END"><code>FILL_END</code></a>ï¼Œç”¨äºè¿›è¡Œå‰ªè£ã€‚å¦‚æœè§†é¢‘çš„å®½é«˜æ¯”ä¸ <code>PreviewView</code> ä¸åŒ¹é…ï¼Œç”»é¢ä¸­åªä¼šæ˜¾ç¤ºéƒ¨åˆ†å†…å®¹ï¼Œä½†è§†é¢‘ä»ä¼šå¡«æ»¡æ•´ä¸ª <code>PreviewView</code>ã€‚</li>
</ul>
<p>CameraX ä½¿ç”¨çš„é»˜è®¤ç¼©æ”¾ç±»å‹æ˜¯ <code>FILL_CENTER</code>ã€‚æ‚¨å¯ä»¥ä½¿ç”¨ <a target="_blank" rel="noopener" href="https://developer.android.google.cn/reference/androidx/camera/view/PreviewView?hl=zh-cn#setScaleType(androidx.camera.view.PreviewView.ScaleType)"><code>PreviewView.setScaleType()</code></a> è®¾ç½®æœ€é€‚åˆå…·ä½“åº”ç”¨çš„ç¼©æ”¾ç±»å‹ã€‚ä¸‹é¢çš„ä»£ç ç¤ºä¾‹è®¾ç½®äº† <code>FIT_CENTER</code> ç¼©æ”¾ç±»å‹ï¼š</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// viewFinder æ˜¯ä¸€ä¸ª PreviewView å®ä¾‹</span></span><br><span class="line">viewFinder.scaleType = PreviewView.ScaleType.FIT_CENTER</span><br></pre></td></tr></table></figure>

<p>è§†é¢‘æ˜¾ç¤ºè¿‡ç¨‹åŒ…æ‹¬ä»¥ä¸‹æ­¥éª¤ï¼š</p>
<ol>
<li>ç¼©æ”¾è§†é¢‘ï¼š<ul>
<li>å¦‚æœæ‚¨é€‰æ‹©çš„ç¼©æ”¾ç±»å‹æ˜¯ <code>FIT_*</code>ï¼Œè¯·ä½¿ç”¨ <code>min(dst.width/src.width, dst.height/src.height)</code> ç¼©æ”¾è§†é¢‘ã€‚</li>
<li>å¦‚æœæ‚¨é€‰æ‹©çš„ç¼©æ”¾ç±»å‹æ˜¯ <code>FILL_*</code>ï¼Œè¯·ä½¿ç”¨ <code>max(dst.width/src.width, dst.height/src.height)</code> ç¼©æ”¾è§†é¢‘ã€‚</li>
</ul>
</li>
<li>å°†ç»è¿‡ç¼©æ”¾çš„è§†é¢‘ä¸ç›®æ ‡PreviewViewå¯¹é½ï¼š<ul>
<li>å¯¹äº <code>FIT_CENTER/FILL_CENTER</code>ï¼Œè¯·å°†ç»è¿‡ç¼©æ”¾çš„è§†é¢‘ä¸ç›®æ ‡ <code>PreviewView</code> å±…ä¸­å¯¹é½ã€‚</li>
<li>å¯¹äº <code>FIT_START/FILL_START</code>ï¼Œè¯·ä»¥æ¯ä¸ªè§†é¢‘çš„å·¦ä¸Šè§’ä¸ºå‡†ï¼Œå°†ç»è¿‡ç¼©æ”¾çš„è§†é¢‘ä¸ç›®æ ‡ <code>PreviewView</code> å¯¹é½ã€‚</li>
<li>å¯¹äº <code>FIT_END/FILL_END</code>ï¼Œè¯·ä»¥æ¯ä¸ªè§†é¢‘çš„å³ä¸‹è§’ä¸ºå‡†ï¼Œå°†ç»è¿‡ç¼©æ”¾çš„è§†é¢‘ä¸ç›®æ ‡ <code>PreviewView</code> å¯¹é½ã€‚</li>
</ul>
</li>
</ol>
<h2 id="é…ç½®é€‰é¡¹"><a href="#é…ç½®é€‰é¡¹" class="headerlink" title="é…ç½®é€‰é¡¹"></a>é…ç½®é€‰é¡¹</h2><p>æ‚¨å¯ä»¥é…ç½®æ¯ä¸ª CameraX ç”¨ä¾‹ï¼Œä»¥æ§åˆ¶ç”¨ä¾‹æ“ä½œçš„ä¸åŒæ–¹é¢ã€‚</p>
<p>ä¾‹å¦‚ï¼Œå¯¹äºå›¾ç‰‡æ‹æ‘„ç”¨ä¾‹ï¼Œæ‚¨å¯ä»¥è®¾ç½®ç›®æ ‡å®½é«˜æ¯”å’Œé—ªå…‰ç¯æ¨¡å¼ã€‚ä»¥ä¸‹ä»£ç æ˜¾ç¤ºäº†ä¸€ä¸ªç¤ºä¾‹ï¼š</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> imageCapture = ImageCapture.Builder()</span><br><span class="line">    .setFlashMode(...)</span><br><span class="line">    .setTargetAspectRatio(...)</span><br><span class="line">    .build()</span><br></pre></td></tr></table></figure>

<p>é™¤é…ç½®é€‰é¡¹ä¹‹å¤–ï¼Œä¸€äº›ç”¨ä¾‹ä¼šå…¬å¼€ API ä»¥ä¾¿åœ¨åˆ›å»ºååŠ¨æ€æ›´æ”¹è®¾ç½®ã€‚å¦‚éœ€äº†è§£å„ä¸ªç”¨ä¾‹çš„ä¸“å±é…ç½®ï¼Œè¯·å‚é˜…<a target="_blank" rel="noopener" href="https://developer.android.google.cn/training/camerax/preview?hl=zh-cn">å®ç°é¢„è§ˆ</a>ã€<a target="_blank" rel="noopener" href="https://developer.android.google.cn/training/camerax/analyze?hl=zh-cn">åˆ†æå›¾ç‰‡</a>å’Œ<a target="_blank" rel="noopener" href="https://developer.android.google.cn/training/camerax/take-photo?hl=zh-cn">å›¾ç‰‡æ‹æ‘„</a>ã€‚</p>
<h3 id="CameraXConfig"><a href="#CameraXConfig" class="headerlink" title="CameraXConfig"></a>CameraXConfig</h3><p>ä¸ºç®€å•èµ·è§ï¼ŒCameraX å…·æœ‰é€‚åˆå¤§å¤šæ•°ä½¿ç”¨åœºæ™¯çš„é»˜è®¤é…ç½®ï¼ˆä¾‹å¦‚å†…éƒ¨æ‰§è¡Œå™¨å’Œå¤„ç†ç¨‹åºï¼‰ã€‚ä½†æ˜¯ï¼Œå¦‚æœæ‚¨çš„åº”ç”¨æœ‰ç‰¹æ®Šè¦æ±‚æˆ–å¸Œæœ›è‡ªå®šä¹‰è¿™äº›é…ç½®ï¼Œå¯ä½¿ç”¨ <a target="_blank" rel="noopener" href="https://developer.android.google.cn/reference/androidx/camera/core/CameraXConfig?hl=zh-cn"><code>CameraXConfig</code></a> æ¥å£å®ç°æ­¤ç›®çš„ã€‚</p>
<p>å€ŸåŠ© <code>CameraXConfig</code>ï¼Œåº”ç”¨å¯ä»¥æ‰§è¡Œä»¥ä¸‹æ“ä½œï¼š</p>
<ul>
<li>ä½¿ç”¨ <a target="_blank" rel="noopener" href="https://developer.android.google.cn/reference/androidx/camera/core/CameraXConfig.Builder?hl=zh-cn#setAvailableCamerasLimiter(androidx.camera.core.CameraSelector)"><code>setAvailableCameraLimiter()</code></a> ä¼˜åŒ–å¯åŠ¨å»¶è¿Ÿæ—¶é—´ã€‚</li>
<li>ä½¿ç”¨ <a target="_blank" rel="noopener" href="https://developer.android.google.cn/reference/androidx/camera/core/CameraXConfig.Builder?hl=zh-cn#setCameraExecutor(java.util.concurrent.Executor)"><code>setCameraExecutor()</code></a> å‘ CameraX æä¾›åº”ç”¨æ‰§è¡Œå™¨ã€‚</li>
<li>å°†é»˜è®¤è°ƒåº¦å™¨å¤„ç†ç¨‹åºæ›¿æ¢ä¸º <a target="_blank" rel="noopener" href="https://developer.android.google.cn/reference/androidx/camera/core/CameraXConfig.Builder?hl=zh-cn#setSchedulerHandler(android.os.Handler)"><code>setSchedulerHandler()</code></a>ã€‚</li>
<li>ä½¿ç”¨ <a target="_blank" rel="noopener" href="https://developer.android.google.cn/reference/androidx/camera/core/CameraXConfig.Builder?hl=zh-cn#setMinimumLoggingLevel(int)"><code>setMinimumLoggingLevel()</code></a> æ›´æ”¹æ—¥å¿—è®°å½•çº§åˆ«ã€‚</li>
</ul>
<h4 id="ä½¿ç”¨æ¨¡å¼"><a href="#ä½¿ç”¨æ¨¡å¼" class="headerlink" title="ä½¿ç”¨æ¨¡å¼"></a>ä½¿ç”¨æ¨¡å¼</h4><p>ä»¥ä¸‹ç¨‹åºè¯´æ˜äº†å¦‚ä½•ä½¿ç”¨ <code>CameraXConfig</code>ï¼š</p>
<ol>
<li>ä½¿ç”¨æ‚¨çš„è‡ªå®šä¹‰é…ç½®åˆ›å»ºä¸€ä¸ª <code>CameraXConfig</code> å¯¹è±¡ã€‚</li>
<li>åœ¨ <a target="_blank" rel="noopener" href="https://developer.android.google.cn/reference/android/app/Application?hl=zh-cn"><code>Application</code></a> ä¸­å®ç° <a target="_blank" rel="noopener" href="https://developer.android.google.cn/reference/androidx/camera/core/CameraXConfig.Provider?hl=zh-cn"><code>CameraXConfig.Provider</code></a> æ¥å£ï¼Œå¹¶åœ¨ <a target="_blank" rel="noopener" href="https://developer.android.google.cn/reference/androidx/camera/core/CameraXConfig.Provider?hl=zh-cn#getCameraXConfig()"><code>getCameraXConfig()</code></a> ä¸­è¿”å› <code>CameraXConfig</code> å¯¹è±¡ã€‚</li>
<li>æŒ‰ç…§<a target="_blank" rel="noopener" href="https://developer.android.google.cn/reference/android/app/Application?hl=zh-cn">æ­¤å¤„</a>çš„è¯´æ˜ï¼Œå°†æ‚¨çš„ <code>Application</code> ç±»æ·»åŠ åˆ° <code>AndroidManifest.xml</code> æ–‡ä»¶ä¸­ã€‚</li>
</ol>
<p>ä¾‹å¦‚ï¼Œä»¥ä¸‹ä»£ç ç¤ºä¾‹å°† CameraX æ—¥å¿—è®°å½•é™åˆ¶ä¸ºä»…è®°å½•é”™è¯¯æ¶ˆæ¯ï¼š</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">CameraApplication</span> : <span class="type">Application</span>(), CameraXConfig.Provider &#123;</span><br><span class="line">   <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">getCameraXConfig</span><span class="params">()</span></span>: CameraXConfig &#123;</span><br><span class="line">       <span class="keyword">return</span> CameraXConfig.Builder.fromConfig(Camera2Config.defaultConfig())</span><br><span class="line">           .setMinimumLoggingLevel(Log.ERROR).build()</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¦‚æœæ‚¨çš„åº”ç”¨éœ€è¦åœ¨è®¾ç½® CameraX é…ç½®åäº†è§£è¯¥é…ç½®ï¼Œè¯·ä¿ç•™ <code>CameraXConfig</code> å¯¹è±¡çš„æœ¬åœ°å‰¯æœ¬ã€‚</p>
<h4 id="æ‘„åƒå¤´é™åˆ¶å™¨"><a href="#æ‘„åƒå¤´é™åˆ¶å™¨" class="headerlink" title="æ‘„åƒå¤´é™åˆ¶å™¨"></a>æ‘„åƒå¤´é™åˆ¶å™¨</h4><p>åœ¨ç¬¬ä¸€æ¬¡è°ƒç”¨ <a target="_blank" rel="noopener" href="https://developer.android.google.cn/reference/androidx/camera/lifecycle/ProcessCameraProvider?hl=zh-cn#getInstance(android.content.Context)"><code>ProcessCameraProvider.getInstance()</code></a> æœŸé—´ï¼ŒCameraX ä¼šæšä¸¾å’ŒæŸ¥è¯¢è®¾å¤‡ä¸Šå¯ç”¨æ‘„åƒå¤´çš„ç‰¹æ€§ã€‚ç”±äº CameraX éœ€è¦ä¸ç¡¬ä»¶ç»„ä»¶é€šä¿¡ï¼Œå› æ­¤å¯¹æ¯ä¸ªæ‘„åƒå¤´æ‰§è¡Œæ­¤è¿‡ç¨‹å¯èƒ½éœ€è¦è¾ƒé•¿æ—¶é—´ï¼Œå°¤å…¶æ˜¯åœ¨ä½ç«¯è®¾å¤‡ä¸Šã€‚å¦‚æœæ‚¨çš„åº”ç”¨ä»…ä½¿ç”¨è®¾å¤‡ä¸Šçš„ç‰¹å®šæ‘„åƒå¤´ï¼ˆä¾‹å¦‚é»˜è®¤å‰ç½®æ‘„åƒå¤´ï¼‰ï¼Œæ‚¨å¯ä»¥å°† CameraX è®¾ç½®ä¸ºå¿½ç•¥å…¶ä»–æ‘„åƒå¤´ï¼Œä»è€Œç¼©çŸ­åº”ç”¨æ‰€ç”¨æ‘„åƒå¤´çš„å¯åŠ¨å»¶è¿Ÿæ—¶é—´ã€‚</p>
<p>å¦‚æœä¼ é€’ç»™ <a target="_blank" rel="noopener" href="https://developer.android.google.cn/reference/androidx/camera/core/CameraXConfig.Builder?hl=zh-cn#setAvailableCamerasLimiter(androidx.camera.core.CameraSelector)"><code>CameraXConfig.Builder.setAvailableCamerasLimiter()</code></a> çš„ <a target="_blank" rel="noopener" href="https://developer.android.google.cn/reference/androidx/camera/core/CameraSelector?hl=zh-cn"><code>CameraSelector</code></a> è¿‡æ»¤æ‰äº†æŸä¸ªæ‘„åƒå¤´ï¼Œåˆ™ CameraX åœ¨è¿è¡Œæ—¶ä¼šå‡å®šè¯¥æ‘„åƒå¤´ä¸å­˜åœ¨ã€‚ä¾‹å¦‚ï¼Œä»¥ä¸‹ä»£ç ä¼šé™åˆ¶åº”ç”¨åªèƒ½ä½¿ç”¨è®¾å¤‡çš„é»˜è®¤åç½®æ‘„åƒå¤´ï¼š</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">MainApplication</span> : <span class="type">Application</span>(), CameraXConfig.Provider &#123;</span><br><span class="line">   <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">getCameraXConfig</span><span class="params">()</span></span>: CameraXConfig &#123;</span><br><span class="line">       <span class="keyword">return</span> CameraXConfig.Builder.fromConfig(Camera2Config.defaultConfig())</span><br><span class="line">              .setAvailableCamerasLimiter(CameraSelector.DEFAULT_BACK_CAMERA)</span><br><span class="line">              .build()</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="çº¿ç¨‹"><a href="#çº¿ç¨‹" class="headerlink" title="çº¿ç¨‹"></a>çº¿ç¨‹</h4><p>æ„å»º CameraX æ—¶æ‰€é‡‡ç”¨çš„å¾ˆå¤šå¹³å° API éƒ½è¦æ±‚é˜»å¡ä¸ç¡¬ä»¶ä¹‹é—´çš„è¿›ç¨‹é—´é€šä¿¡ (IPC)ï¼Œæ­¤ç±»é€šä¿¡æœ‰æ—¶å¯èƒ½éœ€è¦æ•°ç™¾æ¯«ç§’çš„å“åº”æ—¶é—´ã€‚å› æ­¤ï¼ŒCameraX ä»…ä»åå°çº¿ç¨‹è°ƒç”¨è¿™äº› APIï¼Œä»è€Œé¿å…ä¸»çº¿ç¨‹å‘ç”Ÿé˜»å¡ï¼Œä½¿ç•Œé¢ä¿æŒæµç•…ã€‚CameraX ä¼šåœ¨å†…éƒ¨ç®¡ç†è¿™äº›åå°çº¿ç¨‹ï¼Œå› æ­¤è¿™ç±»è¡Œä¸ºæ˜¾å¾—æ¯”è¾ƒé€æ˜ã€‚ä½†æ˜¯ï¼ŒæŸäº›åº”ç”¨éœ€è¦ä¸¥æ ¼æ§åˆ¶çº¿ç¨‹ã€‚<code>CameraXConfig</code> å…è®¸åº”ç”¨è®¾ç½®é€šè¿‡ <a target="_blank" rel="noopener" href="https://developer.android.google.cn/reference/androidx/camera/core/CameraXConfig.Builder?hl=zh-cn#setCameraExecutor(java.util.concurrent.Executor)"><code>CameraXConfig.Builder.setCameraExecutor()</code></a> å’Œ <a target="_blank" rel="noopener" href="https://developer.android.google.cn/reference/androidx/camera/core/CameraXConfig.Builder?hl=zh-cn#setSchedulerHandler(android.os.Handler)"><code>CameraXConfig.Builder.setSchedulerHandler()</code></a> ä½¿ç”¨çš„åå°çº¿ç¨‹ã€‚</p>
<p><strong>æ³¨æ„</strong>ï¼šæä¾›è‡ªå®šä¹‰æ‰§è¡Œå™¨æˆ–è°ƒåº¦å™¨å¤„ç†ç¨‹åºæ—¶ï¼Œè¯·ä½¿ç”¨ä¸ä¼šåœ¨ä¸»çº¿ç¨‹ä¸Šæ‰§è¡Œä»£ç çš„å¤„ç†ç¨‹åºã€‚</p>
<h4 id="æ‘„åƒå¤´æ‰§è¡Œå™¨"><a href="#æ‘„åƒå¤´æ‰§è¡Œå™¨" class="headerlink" title="æ‘„åƒå¤´æ‰§è¡Œå™¨"></a>æ‘„åƒå¤´æ‰§è¡Œå™¨</h4><p>æ‘„åƒå¤´æ‰§è¡Œå™¨ç”¨äºæ‰€æœ‰å†…éƒ¨æ‘„åƒå¤´å¹³å° API è°ƒç”¨ï¼Œä»¥åŠæ¥è‡ªè¿™äº› API çš„å›è°ƒã€‚CameraX ä¼šåˆ†é…å’Œç®¡ç†å†…éƒ¨ <a target="_blank" rel="noopener" href="https://developer.android.google.cn/reference/java/util/concurrent/Executor?hl=zh-cn"><code>Executor</code></a> æ¥æ‰§è¡Œè¿™äº›ä»»åŠ¡ã€‚ ä½†æ˜¯ï¼Œå¦‚æœæ‚¨çš„åº”ç”¨éœ€è¦æ›´ä¸¥æ ¼çš„çº¿ç¨‹æ§åˆ¶ï¼Œè¯·ä½¿ç”¨ <code>CameraXConfig.Builder.setCameraExecutor()</code>ã€‚</p>
<h4 id="è°ƒåº¦å™¨å¤„ç†ç¨‹åº"><a href="#è°ƒåº¦å™¨å¤„ç†ç¨‹åº" class="headerlink" title="è°ƒåº¦å™¨å¤„ç†ç¨‹åº"></a>è°ƒåº¦å™¨å¤„ç†ç¨‹åº</h4><p>è°ƒåº¦å™¨å¤„ç†ç¨‹åºç”¨äºæŒ‰å›ºå®šçš„æ—¶é—´é—´éš”è°ƒåº¦å†…éƒ¨ä»»åŠ¡ï¼Œä¾‹å¦‚åœ¨æ‘„åƒå¤´ä¸å¯ç”¨æ—¶å†æ¬¡å°è¯•æ‰“å¼€è¯¥æ‘„åƒå¤´ã€‚è¯¥å¤„ç†ç¨‹åºä¸æ‰§è¡Œä½œä¸šï¼Œè€Œæ˜¯ä»…å°†ä½œä¸šåˆ†æ´¾ç»™æ‘„åƒå¤´æ‰§è¡Œå™¨ã€‚æœ‰æ—¶ï¼Œè¯¥å¤„ç†ç¨‹åºè¿˜ç”¨äºéœ€è¦ä½¿ç”¨ <a target="_blank" rel="noopener" href="https://developer.android.google.cn/reference/android/os/Handler?hl=zh-cn"><code>Handler</code></a> è¿›è¡Œå›è°ƒçš„æ—§ç‰ˆ API å¹³å°ã€‚åœ¨è¿™äº›æƒ…å†µä¸‹ï¼Œå›è°ƒä»ä»…ç›´æ¥åˆ†æ´¾ç»™æ‘„åƒå¤´æ‰§è¡Œå™¨ã€‚CameraX ä¼šåˆ†é…å’Œç®¡ç†å†…éƒ¨ <a target="_blank" rel="noopener" href="https://developer.android.google.cn/reference/android/os/HandlerThread?hl=zh-cn"><code>HandlerThread</code></a> æ¥æ‰§è¡Œè¿™äº›ä»»åŠ¡ï¼Œä½†æ‚¨å¯ä»¥å°†å…¶æ›¿æ¢ä¸º <code>CameraXConfig.Builder.setSchedulerHandler()</code>ã€‚</p>
<h4 id="æ—¥å¿—è®°å½•"><a href="#æ—¥å¿—è®°å½•" class="headerlink" title="æ—¥å¿—è®°å½•"></a>æ—¥å¿—è®°å½•</h4><p>å€ŸåŠ© CameraX æ—¥å¿—è®°å½•ï¼Œåº”ç”¨å¯ä»¥è¿‡æ»¤ logcat æ¶ˆæ¯ï¼Œå› ä¸ºåœ¨æ­£å¼ç‰ˆä»£ç ä¸­åº”å°½é‡é¿å…åŒ…å«è¯¦ç»†æ¶ˆæ¯ã€‚CameraX æ”¯æŒå››ç§æ—¥å¿—è®°å½•çº§åˆ«ï¼ˆä»æœ€è¯¦ç»†åˆ°æœ€ä¸¥é‡ï¼‰ï¼š</p>
<ul>
<li><code>Log.DEBUG</code>ï¼ˆé»˜è®¤ï¼‰</li>
<li><code>Log.INFO</code></li>
<li><code>Log.WARN</code></li>
<li><code>Log.ERROR</code></li>
</ul>
<p>å¦‚éœ€è¯¦ç»†äº†è§£è¿™äº›æ—¥å¿—çº§åˆ«ï¼Œè¯·å‚é˜… <a target="_blank" rel="noopener" href="https://developer.android.google.cn/reference/android/util/Log?hl=zh-cn#DEBUG">Android æ—¥å¿—æ–‡æ¡£</a>ã€‚æ‚¨å¯ä»¥ä½¿ç”¨ <a target="_blank" rel="noopener" href="https://developer.android.google.cn/reference/androidx/camera/core/CameraXConfig.Builder?hl=zh-cn#setMinimumLoggingLevel(int)"><code>CameraXConfig.Builder.setMinimumLoggingLevel(int)</code></a> ä¸ºæ‚¨çš„åº”ç”¨è®¾ç½®é€‚å½“çš„æ—¥å¿—è®°å½•çº§åˆ«ã€‚</p>
<h3 id="è‡ªåŠ¨é€‰æ‹©"><a href="#è‡ªåŠ¨é€‰æ‹©" class="headerlink" title="è‡ªåŠ¨é€‰æ‹©"></a>è‡ªåŠ¨é€‰æ‹©</h3><p>CameraX ä¼šæ ¹æ®è¿è¡Œæ‚¨çš„åº”ç”¨çš„è®¾å¤‡è‡ªåŠ¨æä¾›ä¸“ç”¨çš„åŠŸèƒ½ã€‚ä¾‹å¦‚ï¼Œå¦‚æœæ‚¨æœªæŒ‡å®šåˆ†è¾¨ç‡æˆ–æ‚¨æŒ‡å®šçš„åˆ†è¾¨ç‡ä¸å—æ”¯æŒï¼ŒCameraX ä¼šè‡ªåŠ¨ç¡®å®šè¦ä½¿ç”¨çš„æœ€ä½³åˆ†è¾¨ç‡ã€‚æ‰€æœ‰è¿™äº›æ“ä½œå‡ç”±åº“è¿›è¡Œå¤„ç†ï¼Œæ— éœ€æ‚¨ç¼–å†™è®¾å¤‡ä¸“å±ä»£ç ã€‚</p>
<p>CameraX çš„ç›®æ ‡æ˜¯æˆåŠŸåˆå§‹åŒ–æ‘„åƒå¤´ä¼šè¯ã€‚è¿™æ„å‘³ç€ï¼ŒCameraX ä¼šæ ¹æ®è®¾å¤‡åŠŸèƒ½é™ä½åˆ†è¾¨ç‡å’Œå®½é«˜æ¯”ã€‚å‘ç”Ÿè¿™ç§æƒ…å†µçš„åŸå› å¦‚ä¸‹ï¼š</p>
<ul>
<li>è®¾å¤‡ä¸æ”¯æŒè¯·æ±‚çš„åˆ†è¾¨ç‡ã€‚</li>
<li>è®¾å¤‡å­˜åœ¨å…¼å®¹æ€§é—®é¢˜ï¼Œä¾‹å¦‚éœ€è¦ç‰¹å®šåˆ†è¾¨ç‡æ‰èƒ½æ­£å¸¸è¿è¡Œçš„æ—§è®¾å¤‡ã€‚</li>
<li>åœ¨æŸäº›è®¾å¤‡ä¸Šï¼ŒæŸäº›æ ¼å¼ä»…åœ¨æŸäº›å®½é«˜æ¯”ä¸‹å¯ç”¨ã€‚</li>
<li>å¯¹äº JPEG æˆ–è§†é¢‘ç¼–ç ï¼Œè®¾å¤‡é¦–é€‰â€œæœ€è¿‘çš„ mod16â€ã€‚å¦‚éœ€äº†è§£è¯¦æƒ…ï¼Œè¯·å‚é˜… <a target="_blank" rel="noopener" href="https://developer.android.google.cn/reference/android/hardware/camera2/CameraCharacteristics?hl=zh-cn#SCALER_STREAM_CONFIGURATION_MAP"><code>SCALER_STREAM_CONFIGURATION_MAP</code></a>ã€‚</li>
</ul>
<p>å°½ç®¡ CameraX ä¼šåˆ›å»ºå¹¶ç®¡ç†ä¼šè¯ï¼Œæ‚¨ä¹Ÿåº”å§‹ç»ˆåœ¨ä»£ç ä¸­æ£€æŸ¥ç”¨ä¾‹è¾“å‡ºæ‰€è¿”å›çš„å›¾ç‰‡å¤§å°ï¼Œå¹¶è¿›è¡Œç›¸åº”è°ƒæ•´ã€‚</p>
<h3 id="æ—‹è½¬"><a href="#æ—‹è½¬" class="headerlink" title="æ—‹è½¬"></a>æ—‹è½¬</h3><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œåœ¨ç”¨ä¾‹åˆ›å»ºæœŸé—´ï¼Œæ‘„åƒå¤´çš„æ—‹è½¬è§’åº¦ä¼šè®¾ç½®ä¸ºä¸é»˜è®¤çš„æ˜¾ç¤ºå±æ—‹è½¬è§’åº¦ä¿æŒä¸€è‡´ã€‚åœ¨æ­¤é»˜è®¤æƒ…å†µä¸‹ï¼ŒCameraX ä¼šç”Ÿæˆè¾“å‡ºï¼Œç¡®ä¿åº”ç”¨ä¸æ‚¨é¢„æœŸåœ¨é¢„è§ˆä¸­çœ‹åˆ°çš„å†…å®¹ä¿æŒä¸€è‡´ã€‚é€šè¿‡åœ¨é…ç½®ç”¨ä¾‹å¯¹è±¡æ—¶ä¼ å…¥å½“å‰æ˜¾ç¤ºå±æ–¹å‘æˆ–åœ¨åˆ›å»ºç”¨ä¾‹å¯¹è±¡ä¹‹ååŠ¨æ€ä¼ å…¥æ˜¾ç¤ºå±æ–¹å‘ï¼Œæ‚¨å¯ä»¥å°†æ—‹è½¬è§’åº¦æ›´æ”¹ä¸ºè‡ªå®šä¹‰å€¼ä»¥æ”¯æŒå¤šæ˜¾ç¤ºå±è®¾å¤‡ã€‚</p>
<p>æ‚¨çš„åº”ç”¨å¯ä»¥ä½¿ç”¨é…ç½®è®¾ç½®æ¥è®¾ç½®ç›®æ ‡æ—‹è½¬è§’åº¦ã€‚ç„¶åï¼Œå³ä½¿ç”Ÿå‘½å‘¨æœŸå¤„äºè¿è¡ŒçŠ¶æ€ï¼Œåº”ç”¨ä¹Ÿå¯ä»¥é€šè¿‡ä½¿ç”¨ç”¨ä¾‹ API ä¸­çš„æ–¹æ³•ï¼ˆä¾‹å¦‚ <a target="_blank" rel="noopener" href="https://developer.android.google.cn/reference/androidx/camera/core/ImageAnalysis?hl=zh-cn#setTargetRotation(int)"><code>ImageAnalysis.setTargetRotation()</code></a>ï¼‰æ›´æ–°æ—‹è½¬è®¾ç½®ã€‚æ‚¨å¯ä»¥åœ¨åº”ç”¨é”å®šä¸ºçºµå‘æ¨¡å¼æ—¶æ‰§è¡Œä¸Šè¿°æ“ä½œï¼Œè¿™æ ·å°±æ— éœ€é‡æ–°é…ç½®æ—‹è½¬è§’åº¦ï¼Œä½†æ˜¯ç…§ç‰‡æˆ–åˆ†æç”¨ä¾‹éœ€è¦äº†è§£è®¾å¤‡å½“å‰çš„æ—‹è½¬è§’åº¦ã€‚ä¾‹å¦‚ï¼Œç”¨ä¾‹å¯èƒ½éœ€è¦äº†è§£æ—‹è½¬è§’åº¦æ‰èƒ½ä»¥æ­£ç¡®çš„æ–¹å‘è¿›è¡Œäººè„¸æ£€æµ‹ï¼Œæˆ–è€…å°†ç…§ç‰‡è®¾ç½®ä¸ºæ¨ªå‘æˆ–çºµå‘ã€‚</p>
<p>å­˜å‚¨æ‰€æ‹æ‘„å›¾ç‰‡çš„æ•°æ®æ—¶å¯èƒ½ä¸ä¼šåŒ…å«æ—‹è½¬ä¿¡æ¯ã€‚Exif æ•°æ®åŒ…å«æ—‹è½¬ä¿¡æ¯ï¼Œä»¥ä¾¿å›¾åº“åº”ç”¨åœ¨ä¿å­˜åä»¥æ­£ç¡®çš„å±å¹•æ–¹å‘æ˜¾ç¤ºå›¾ç‰‡ã€‚</p>
<p>å¦‚éœ€ä»¥æ­£ç¡®çš„å±å¹•æ–¹å‘æ˜¾ç¤ºé¢„è§ˆæ•°æ®ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ <a target="_blank" rel="noopener" href="https://developer.android.google.cn/reference/androidx/camera/core/Preview.PreviewOutput?hl=zh-cn"><code>Preview.PreviewOutput()</code></a> çš„å…ƒæ•°æ®è¾“å‡ºåˆ›å»ºè½¬æ¢ã€‚</p>
<p>ä»¥ä¸‹ä»£ç ç¤ºä¾‹å±•ç¤ºäº†å¦‚ä½•ä¸ºå±å¹•æ–¹å‘äº‹ä»¶è®¾ç½®æ—‹è½¬è§’åº¦ï¼š</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onCreate</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">val</span> imageCapture = ImageCapture.Builder().build()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">val</span> orientationEventListener = <span class="keyword">object</span> : OrientationEventListener(<span class="keyword">this</span> <span class="keyword">as</span> Context) &#123;</span><br><span class="line">        <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onOrientationChanged</span><span class="params">(orientation : <span class="type">Int</span>)</span></span> &#123;</span><br><span class="line">            <span class="comment">// Monitors orientation values to determine the target rotation value</span></span><br><span class="line">            <span class="keyword">val</span> rotation : <span class="built_in">Int</span> = <span class="keyword">when</span> (orientation) &#123;</span><br><span class="line">                <span class="keyword">in</span> <span class="number">45.</span><span class="number">.134</span> -&gt; Surface.ROTATION_270</span><br><span class="line">                <span class="keyword">in</span> <span class="number">135.</span><span class="number">.224</span> -&gt; Surface.ROTATION_180</span><br><span class="line">                <span class="keyword">in</span> <span class="number">225.</span><span class="number">.314</span> -&gt; Surface.ROTATION_90</span><br><span class="line">                <span class="keyword">else</span> -&gt; Surface.ROTATION_0</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            imageCapture.targetRotation = rotation</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    orientationEventListener.enable()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ¯ä¸ªç”¨ä¾‹éƒ½ä¼šæ ¹æ®è®¾å®šçš„æ—‹è½¬è§’åº¦ç›´æ¥æ—‹è½¬å›¾ç‰‡æ•°æ®ï¼Œæˆ–è€…å‘ç”¨æˆ·æä¾›æœªæ—‹è½¬å›¾ç‰‡æ•°æ®çš„æ—‹è½¬å…ƒæ•°æ®ã€‚</p>
<ul>
<li><strong>Preview</strong>ï¼šæä¾›å…ƒæ•°æ®è¾“å‡ºï¼Œä»¥ä¾¿ä½¿ç”¨ <a target="_blank" rel="noopener" href="https://developer.android.google.cn/reference/androidx/camera/core/Preview?hl=zh-cn#getTargetRotation()"><code>Preview.getTargetRotation()</code></a> äº†è§£ç›®æ ‡åˆ†è¾¨ç‡çš„æ—‹è½¬è®¾ç½®ã€‚</li>
<li><strong>ImageAnalysis</strong>ï¼šæä¾›å…ƒæ•°æ®è¾“å‡ºï¼Œä»¥ä¾¿äº†è§£å›¾ç‰‡ç¼“å†²åŒºåæ ‡ç›¸å¯¹äºæ˜¾ç¤ºåæ ‡çš„ä½ç½®ã€‚</li>
<li><strong>ImageCapture</strong>ï¼šæ›´æ”¹å›¾ç‰‡ Exif å…ƒæ•°æ®ã€ç¼“å†²åŒºæˆ–åŒæ—¶æ›´æ”¹ä¸¤è€…ï¼Œä»è€Œåæ˜ æ—‹è½¬è®¾ç½®ã€‚æ›´æ”¹çš„å€¼å–å†³äº HAL å®ç°ã€‚</li>
</ul>
<h3 id="å‰ªè£çŸ©å½¢"><a href="#å‰ªè£çŸ©å½¢" class="headerlink" title="å‰ªè£çŸ©å½¢"></a>å‰ªè£çŸ©å½¢</h3><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œå‰ªè£çŸ©å½¢æ˜¯å®Œæ•´çš„ç¼“å†²åŒºçŸ©å½¢ï¼Œæ‚¨å¯é€šè¿‡ <a target="_blank" rel="noopener" href="https://developer.android.google.cn/reference/androidx/camera/core/ViewPort?hl=zh-cn"><code>ViewPort</code></a> å’Œ <a target="_blank" rel="noopener" href="https://developer.android.google.cn/reference/androidx/camera/core/UseCaseGroup?hl=zh-cn"><code>UseCaseGroup</code></a> å¯¹å…¶è¿›è¡Œè‡ªå®šä¹‰ã€‚é€šè¿‡å¯¹ç”¨ä¾‹è¿›è¡Œåˆ†ç»„å¹¶è®¾ç½®è§†å£ï¼ŒCameraX å¯ä¿è¯ä¸€ä¸ªç»„ä¸­çš„æ‰€æœ‰ç”¨ä¾‹çš„å‰ªè£çŸ©å½¢éƒ½æŒ‡å‘æ‘„åƒå¤´ä¼ æ„Ÿå™¨ä¸­çš„åŒä¸€ä¸ªåŒºåŸŸã€‚</p>
<p>ä»¥ä¸‹ä»£ç æ®µå±•ç¤ºäº†è¿™ä¸¤ä¸ªç±»çš„ä½¿ç”¨æ–¹æ³•ï¼š</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> viewPort =  ViewPort.Builder(Rational(width, height), display.rotation).build()</span><br><span class="line"><span class="keyword">val</span> useCaseGroup = UseCaseGroup.Builder()</span><br><span class="line">    .addUseCase(preview)</span><br><span class="line">    .addUseCase(imageAnalysis)</span><br><span class="line">    .addUseCase(imageCapture)</span><br><span class="line">    .setViewPort(viewPort)</span><br><span class="line">    .build()</span><br><span class="line">cameraProvider.bindToLifecycle(lifecycleOwner, cameraSelector, useCaseGroup)</span><br></pre></td></tr></table></figure>

<p><code>ViewPort</code> ç”¨äºæŒ‡å®šæœ€ç»ˆç”¨æˆ·å¯çœ‹åˆ°çš„ç¼“å†²åŒºçŸ©å½¢ã€‚CameraX ä¼šæ ¹æ®è§†å£çš„å±æ€§åŠé™„åŠ çš„ç”¨ä¾‹è®¡ç®—å‡ºå¯èƒ½çš„æœ€å¤§å‰ªè£çŸ©å½¢ã€‚ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œä¸ºäº†è¾¾åˆ° WYSIWYG æ•ˆæœï¼Œæ‚¨åº”æ ¹æ®é¢„è§ˆç”¨ä¾‹æ¥é…ç½®è§†å£ã€‚è·å–è§†å£çš„ä¸€ç§ç®€å•æ–¹æ³•æ˜¯ä½¿ç”¨ <a target="_blank" rel="noopener" href="https://developer.android.google.cn/training/camerax/preview?hl=zh-cn#implementation"><code>PreviewView</code></a>ã€‚</p>
<p>ä»¥ä¸‹ä»£ç æ®µå±•ç¤ºäº†å¦‚ä½•è·å– <code>ViewPort</code> å¯¹è±¡ï¼š</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> viewport = findViewById&lt;PreviewView&gt;(R.id.preview_view).viewPort</span><br></pre></td></tr></table></figure>

<p>åœ¨å‰é¢çš„ç¤ºä¾‹ä¸­ï¼Œåº”ç”¨é€šè¿‡ <code>ImageAnalysis</code> å’Œ <code>ImageCapture</code> è·å–çš„å†…å®¹ä¸æœ€ç»ˆç”¨æˆ·åœ¨ <code>PreviewView</code> ä¸­çœ‹åˆ°çš„å†…å®¹ç›¸åŒï¼ˆå‡å®š <code>PreviewView</code> çš„ç¼©æ”¾ç±»å‹è®¾ä¸ºé»˜è®¤å€¼ <code>FILL_CENTER</code>ï¼‰ã€‚å°†å‰ªè£çŸ©å½¢å’Œæ—‹è½¬è§’åº¦åº”ç”¨åˆ°è¾“å‡ºç¼“å†²åŒºåï¼Œå›¾ç‰‡å°†åœ¨æ‰€æœ‰ç”¨ä¾‹ä¸­ä¿æŒä¸€è‡´ï¼Œä½†åˆ†è¾¨ç‡å¯èƒ½ä¼šæœ‰æ‰€ä¸åŒã€‚å¦‚éœ€è¯¦ç»†äº†è§£å¦‚ä½•åº”ç”¨è½¬æ¢ä¿¡æ¯ï¼Œè¯·å‚é˜…<a target="_blank" rel="noopener" href="https://developer.android.google.cn/training/camerax/transform-output?hl=zh-cn">è½¬æ¢è¾“å‡º</a>ã€‚</p>
<h3 id="æ‘„åƒå¤´åˆ†è¾¨ç‡"><a href="#æ‘„åƒå¤´åˆ†è¾¨ç‡" class="headerlink" title="æ‘„åƒå¤´åˆ†è¾¨ç‡"></a>æ‘„åƒå¤´åˆ†è¾¨ç‡</h3><p>æ‚¨å¯ä»¥é€‰æ‹©è®© CameraX æ ¹æ®è®¾å¤‡åŠŸèƒ½ã€è®¾å¤‡æ”¯æŒçš„<a target="_blank" rel="noopener" href="https://developer.android.google.cn/reference/android/hardware/camera2/CameraCharacteristics?hl=zh-cn#INFO_SUPPORTED_HARDWARE_LEVEL">ç¡¬ä»¶çº§åˆ«</a>ã€ç”¨ä¾‹å’Œæ‰€æä¾›çš„å®½é«˜æ¯”ç»„åˆè®¾ç½®å›¾ç‰‡åˆ†è¾¨ç‡ã€‚æˆ–è€…ï¼Œæ‚¨ä¹Ÿå¯ä»¥åœ¨æ”¯æŒç›¸åº”é…ç½®çš„ç”¨ä¾‹ä¸­è®¾ç½®ç‰¹å®šç›®æ ‡åˆ†è¾¨ç‡æˆ–ç‰¹å®šå®½é«˜æ¯”ã€‚</p>
<h4 id="è‡ªåŠ¨åˆ†è¾¨ç‡"><a href="#è‡ªåŠ¨åˆ†è¾¨ç‡" class="headerlink" title="è‡ªåŠ¨åˆ†è¾¨ç‡"></a>è‡ªåŠ¨åˆ†è¾¨ç‡</h4><p>CameraX å¯ä»¥æ ¹æ® <code>cameraProcessProvider.bindToLifecycle()</code> ä¸­æŒ‡å®šçš„ç”¨ä¾‹è‡ªåŠ¨ç¡®å®šæœ€ä½³åˆ†è¾¨ç‡è®¾ç½®ã€‚è¯·å°½å¯èƒ½åœ¨å•ä¸ª <code>bindToLifecycle()</code> è°ƒç”¨çš„å•ä¸ªä¼šè¯ä¸­æŒ‡å®šéœ€è¦åŒæ—¶è¿è¡Œçš„æ‰€æœ‰ç”¨ä¾‹ã€‚CameraX ä¼šè€ƒè™‘è®¾å¤‡æ”¯æŒçš„ç¡¬ä»¶çº§åˆ«ä»¥åŠè®¾å¤‡ä¸“å±å˜åŒ–ï¼ˆè®¾å¤‡è¶…å‡ºæˆ–ä¸æ»¡è¶³<a target="_blank" rel="noopener" href="https://developer.android.google.cn/reference/android/hardware/camera2/CameraDevice?hl=zh-cn#createCaptureSession(android.hardware.camera2.params.SessionConfiguration)">å¯ç”¨çš„ä¿¡æ¯æµé…ç½®</a>ï¼‰ï¼Œæ ¹æ®ç»‘å®šçš„æˆç»„ç”¨ä¾‹ç¡®å®šåˆ†è¾¨ç‡ã€‚ è¿™æ ·åšæ˜¯ä¸ºäº†ç¡®ä¿åº”ç”¨åœ¨å„ç§è®¾å¤‡ä¸Šè¿è¡Œæ—¶ï¼Œèƒ½å¤Ÿæœ€å¤§é™åº¦åœ°å‡å°‘è®¾å¤‡ä¸“å±ä»£ç è·¯å¾„ã€‚</p>
<p>å›¾ç‰‡æ‹æ‘„å’Œå›¾ç‰‡åˆ†æç”¨ä¾‹çš„é»˜è®¤å®½é«˜æ¯”ä¸º 4:3ã€‚</p>
<p>å¯¹äºå…·æœ‰å¯é…ç½®å®½é«˜æ¯”çš„ç”¨ä¾‹ï¼Œå¯è®©åº”ç”¨æ ¹æ®ç•Œé¢è®¾è®¡æ¥æŒ‡å®šæ‰€éœ€çš„å®½é«˜æ¯”ã€‚CameraX ä¼šæŒ‰ç…§è¯·æ±‚çš„å®½é«˜æ¯”ç”Ÿæˆè¾“å‡ºï¼Œå¹¶å°½å¯èƒ½åŒ¹é…è®¾å¤‡æ”¯æŒçš„å®½é«˜æ¯”ã€‚å¦‚æœæ²¡æœ‰ä»»ä½•æ”¯æŒçš„å®Œå…¨åŒ¹é…åˆ†è¾¨ç‡ï¼Œåˆ™é€‰æ‹©æ»¡è¶³æœ€å¤šæ¡ä»¶çš„åˆ†è¾¨ç‡ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œåº”ç”¨ä¼šå†³å®šæ‘„åƒå¤´åœ¨åº”ç”¨ä¸­çš„æ˜¾ç¤ºæ–¹å¼ï¼ŒCameraX åˆ™ä¼šå†³å®šæœ€ä½³æ‘„åƒå¤´åˆ†è¾¨ç‡è®¾ç½®ï¼Œä»¥æ»¡è¶³ä¸åŒè®¾å¤‡çš„å…·ä½“è¦æ±‚ã€‚</p>
<p>ä¾‹å¦‚ï¼Œåº”ç”¨å¯ä»¥æ‰§è¡Œä»¥ä¸‹ä»»ä¸€æ“ä½œï¼š</p>
<ul>
<li>ä¸ºç”¨ä¾‹æŒ‡å®š 4:3 æˆ– 16:9 çš„ç›®æ ‡åˆ†è¾¨ç‡</li>
<li>æŒ‡å®šè‡ªå®šä¹‰åˆ†è¾¨ç‡ï¼ŒCameraX ä¼šå°è¯•æŸ¥æ‰¾ä¸è¯¥åˆ†è¾¨ç‡æœ€æ¥è¿‘çš„åˆ†è¾¨ç‡</li>
<li>ä¸º <code>ImageCapture</code> æŒ‡å®šå‰ªè£å®½é«˜æ¯”</li>
</ul>
<p>CameraX ä¼šè‡ªåŠ¨é€‰æ‹©å†…éƒ¨ Camera2 ç•Œé¢çš„åˆ†è¾¨ç‡ã€‚ä¸‹è¡¨æ˜¾ç¤ºäº†è¿™äº›åˆ†è¾¨ç‡ï¼š</p>
<table>
<thead>
<tr>
<th align="left"><strong>ç”¨ä¾‹</strong></th>
<th align="left"><strong>å†…éƒ¨ç•Œé¢åˆ†è¾¨ç‡</strong></th>
<th align="left"><strong>è¾“å‡ºæ•°æ®åˆ†è¾¨ç‡</strong></th>
</tr>
</thead>
<tbody><tr>
<td align="left">é¢„è§ˆ</td>
<td align="left"><strong>å®½é«˜æ¯”</strong>ï¼šä½¿ç›®æ ‡ä¸è®¾ç½®æœ€ç›¸ç¬¦çš„åˆ†è¾¨ç‡ã€‚</td>
<td align="left">å†…éƒ¨ç•Œé¢åˆ†è¾¨ç‡ã€‚é€šè¿‡æä¾›å…ƒæ•°æ®ï¼Œå¯è®©è§†å›¾é’ˆå¯¹ç›®æ ‡å®½é«˜æ¯”è¿›è¡Œå‰ªè£ã€ç¼©æ”¾å’Œæ—‹è½¬ã€‚</td>
</tr>
<tr>
<td align="left"><strong>é»˜è®¤åˆ†è¾¨ç‡ï¼š</strong>æœ€é«˜çš„é¢„è§ˆåˆ†è¾¨ç‡ï¼Œæˆ–ä¸é¢„è§ˆå®½é«˜æ¯”åŒ¹é…çš„æœ€é«˜è®¾å¤‡é¦–é€‰åˆ†è¾¨ç‡ã€‚</td>
<td align="left"></td>
<td align="left"></td>
</tr>
<tr>
<td align="left"><strong>æœ€å¤§åˆ†è¾¨ç‡ï¼š</strong>é¢„è§ˆå¤§å°ï¼ŒæŒ‡çš„æ˜¯ä¸è®¾å¤‡çš„å±å¹•åˆ†è¾¨ç‡æˆ– 1080p (1920x1080)ï¼ˆä»¥è¾ƒä½è€…ä¸ºå‡†ï¼‰åŒ¹é…çš„æœ€ä½³å°ºå¯¸ã€‚</td>
<td align="left"></td>
<td align="left"></td>
</tr>
<tr>
<td align="left">å›¾ç‰‡åˆ†æ</td>
<td align="left"><strong>å®½é«˜æ¯”</strong>ï¼šä½¿ç›®æ ‡ä¸è®¾ç½®æœ€ç›¸ç¬¦çš„åˆ†è¾¨ç‡ã€‚</td>
<td align="left">å†…éƒ¨ç•Œé¢åˆ†è¾¨ç‡ã€‚</td>
</tr>
<tr>
<td align="left"><strong>é»˜è®¤åˆ†è¾¨ç‡</strong>ï¼šé»˜è®¤ç›®æ ‡åˆ†è¾¨ç‡è®¾ç½®ä¸º 640x480ã€‚åŒæ—¶è°ƒæ•´ç›®æ ‡åˆ†è¾¨ç‡å’Œç›¸åº”çš„å®½é«˜æ¯”å¯è·å¾—æ”¯æŒçš„æœ€ä½³åˆ†è¾¨ç‡ã€‚</td>
<td align="left"></td>
<td align="left"></td>
</tr>
<tr>
<td align="left"><strong>æœ€å¤§åˆ†è¾¨ç‡</strong>ï¼šä» <a target="_blank" rel="noopener" href="https://developer.android.google.cn/reference/android/hardware/camera2/params/StreamConfigurationMap?hl=zh-cn#getOutputSizes(int)"><code>StreamConfigurationMap.getOutputSizes()</code></a> ä¸­æ£€ç´¢åˆ°çš„ YUV_420_888 æ ¼å¼çš„æ‘„åƒå¤´è®¾å¤‡æœ€å¤§è¾“å‡ºåˆ†è¾¨ç‡ã€‚ ç›®æ ‡åˆ†è¾¨ç‡é»˜è®¤è®¾ç½®ä¸º 640x480ã€‚å› æ­¤ï¼Œå¦‚æœæ‚¨å¸Œæœ›åˆ†è¾¨ç‡å¤§äº 640x480ï¼Œå¿…é¡»ä½¿ç”¨ <a target="_blank" rel="noopener" href="https://developer.android.google.cn/reference/kotlin/androidx/camera/core/ImageAnalysis.Builder?hl=zh-cn#settargetresolution"><code>setTargetResolution()</code></a> å’Œ <a target="_blank" rel="noopener" href="https://developer.android.google.cn/reference/kotlin/androidx/camera/core/ImageAnalysis.Builder?hl=zh-cn#settargetaspectratio"><code>setTargetAspectRatio()</code></a> ä»æ”¯æŒçš„åˆ†è¾¨ç‡ä¸­é€‰æ‹©æœ€æ¥è¿‘çš„ä¸€ä¸ªã€‚</td>
<td align="left"></td>
<td align="left"></td>
</tr>
<tr>
<td align="left">å›¾ç‰‡æ‹æ‘„</td>
<td align="left"><strong>å®½é«˜æ¯”</strong>ï¼šæœ€é€‚åˆè®¾ç½®çš„å®½é«˜æ¯”ã€‚</td>
<td align="left">å†…éƒ¨ç•Œé¢åˆ†è¾¨ç‡ã€‚</td>
</tr>
<tr>
<td align="left"><strong>é»˜è®¤åˆ†è¾¨ç‡</strong>ï¼šæœ€é«˜å¯ç”¨åˆ†è¾¨ç‡ï¼Œæˆ–ä¸ ImageCapture çš„å®½é«˜æ¯”åŒ¹é…çš„æœ€é«˜è®¾å¤‡é¦–é€‰åˆ†è¾¨ç‡ã€‚</td>
<td align="left"></td>
<td align="left"></td>
</tr>
<tr>
<td align="left"><strong>æœ€å¤§åˆ†è¾¨ç‡</strong>ï¼šJPEG æ ¼å¼çš„æ‘„åƒå¤´è®¾å¤‡æœ€å¤§è¾“å‡ºåˆ†è¾¨ç‡ã€‚è¯·ä½¿ç”¨ <a target="_blank" rel="noopener" href="https://developer.android.google.cn/reference/android/hardware/camera2/params/StreamConfigurationMap?hl=zh-cn#getOutputSizes(int)"><code>StreamConfigurationMap.getOutputSizes()</code></a> æ£€ç´¢æ­¤åˆ†è¾¨ç‡ã€‚</td>
<td align="left"></td>
<td align="left"></td>
</tr>
</tbody></table>
<h4 id="æŒ‡å®šåˆ†è¾¨ç‡"><a href="#æŒ‡å®šåˆ†è¾¨ç‡" class="headerlink" title="æŒ‡å®šåˆ†è¾¨ç‡"></a>æŒ‡å®šåˆ†è¾¨ç‡</h4><p>ä½¿ç”¨ <code>setTargetResolution(Size resolution)</code> æ–¹æ³•æ„å»ºç”¨ä¾‹æ—¶ï¼Œæ‚¨å¯ä»¥è®¾ç½®ç‰¹å®šåˆ†è¾¨ç‡ï¼Œå¦‚ä»¥ä¸‹ä»£ç ç¤ºä¾‹æ‰€ç¤ºï¼š</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> imageAnalysis = ImageAnalysis.Builder()</span><br><span class="line">    .setTargetResolution(Size(<span class="number">1280</span>, <span class="number">720</span>))</span><br><span class="line">    .build()</span><br></pre></td></tr></table></figure>

<p>æ‚¨æ— æ³•é’ˆå¯¹åŒä¸€ä¸ªç”¨ä¾‹è®¾ç½®ç›®æ ‡å®½é«˜æ¯”å’Œç›®æ ‡åˆ†è¾¨ç‡ã€‚å¦‚æœè¿™æ ·åšï¼Œåˆ™ä¼šåœ¨æ„å»ºé…ç½®å¯¹è±¡æ—¶æŠ›å‡º <code>IllegalArgumentException</code>ã€‚</p>
<p>æŒ‰ç…§ç›®æ ‡æ—‹è½¬è§’åº¦æ—‹è½¬æ”¯æŒçš„å¤§å°åï¼Œè¯·åœ¨åæ ‡ç³»ä¸­è¡¨ç¤ºåˆ†è¾¨ç‡ <a target="_blank" rel="noopener" href="https://developer.android.google.cn/reference/android/util/Size?hl=zh-cn"><code>Size</code></a>ã€‚ä¾‹å¦‚ï¼Œè‡ªç„¶å±å¹•æ–¹å‘ä¸ºçºµå‘å¹¶é‡‡ç”¨è‡ªç„¶ç›®æ ‡æ—‹è½¬è§’åº¦çš„è®¾å¤‡å¦‚æœè¯·æ±‚çºµå‘å›¾ç‰‡ï¼Œå¯æŒ‡å®š 480x640ï¼›è€ŒåŒä¸€è®¾å¤‡æ—‹è½¬ 90 åº¦å¹¶ä»¥æ¨ªå‘å±å¹•æ–¹å‘ä¸ºç›®æ ‡åï¼Œå¯æŒ‡å®š 640x480ã€‚</p>
<p>ç›®æ ‡åˆ†è¾¨ç‡ä¼šå°è¯•åˆ¶å®šå›¾ç‰‡åˆ†è¾¨ç‡çš„ä¸‹é™ã€‚å®é™…çš„å›¾ç‰‡åˆ†è¾¨ç‡æ˜¯æœ€æ¥è¿‘çš„å¯ç”¨åˆ†è¾¨ç‡ï¼Œå…¶å¤§å°ä¸å°äºç”±æ‘„åƒå¤´å®ç°æ‰€å†³å®šçš„ç›®æ ‡åˆ†è¾¨ç‡ã€‚</p>
<p>ä½†æ˜¯ï¼Œå¦‚æœä¸å­˜åœ¨ç­‰äºæˆ–å¤§äºç›®æ ‡åˆ†è¾¨ç‡çš„åˆ†è¾¨ç‡ï¼Œå°±ä¼šä»å°äºç›®æ ‡åˆ†è¾¨ç‡çš„å¯ç”¨åˆ†è¾¨ç‡ä¸­é€‰æ‹©æœ€æ¥è¿‘çš„ä¸€ä¸ªã€‚ä¸æä¾›çš„ <code>Size</code> å…·æœ‰ç›¸åŒå®½é«˜æ¯”çš„åˆ†è¾¨ç‡ï¼Œå…¶ä¼˜å…ˆçº§é«˜äºå…·æœ‰ä¸åŒå®½é«˜æ¯”çš„åˆ†è¾¨ç‡ã€‚</p>
<p>CameraX ä¼šæ ¹æ®è¯·æ±‚åº”ç”¨æœ€åˆé€‚çš„åˆ†è¾¨ç‡ã€‚å¦‚æœä¸»è¦éœ€æ±‚æ˜¯æ»¡è¶³å®½é«˜æ¯”è¦æ±‚ï¼Œåˆ™ä»…æŒ‡å®š <code>setTargetAspectRatio</code>ï¼ŒCameraX ä¼šæ ¹æ®è®¾å¤‡ç¡®å®šåˆé€‚çš„ç‰¹å®šåˆ†è¾¨ç‡ã€‚ å¦‚æœåº”ç”¨çš„ä¸»è¦éœ€æ±‚æ˜¯æŒ‡å®šåˆ†è¾¨ç‡ä»¥æé«˜å›¾ç‰‡å¤„ç†æ•ˆç‡ï¼ˆä¾‹å¦‚æ ¹æ®è®¾å¤‡å¤„ç†èƒ½åŠ›å¤„ç†è¾ƒå°æˆ–ä¸­ç­‰å¤§å°çš„å›¾ç‰‡ï¼‰ï¼Œè¯·ä½¿ç”¨ <code>setTargetResolution(Size resolution)</code>ã€‚</p>
<p><strong>æ³¨æ„ï¼š</strong>å¦‚æœä½¿ç”¨ <code>setTargetResolution()</code>ï¼Œå¯èƒ½ä¼šå¾—åˆ°å®½é«˜æ¯”ä¸å…¶ä»–ç”¨ä¾‹ä¸åŒ¹é…çš„ç¼“å†²åŒºã€‚å¦‚æœå®½é«˜æ¯”å¿…é¡»åŒ¹é…ï¼Œè¯·æ£€æŸ¥ä¸¤ä¸ªç”¨ä¾‹è¿”å›çš„ç¼“å†²åŒºå°ºå¯¸ï¼Œç„¶åå‰ªè£æˆ–ç¼©æ”¾å…¶ä¸­ä¸€ä¸ªä»¥ä¸å¦ä¸€ä¸ªåŒ¹é…ã€‚</p>
<p>å¦‚æœæ‚¨çš„åº”ç”¨éœ€è¦ç²¾ç¡®çš„åˆ†è¾¨ç‡ï¼Œè¯·å‚é˜… <a target="_blank" rel="noopener" href="https://developer.android.google.cn/reference/android/hardware/camera2/CameraDevice?hl=zh-cn#regular-capture"><code>createCaptureSession()</code></a> å†…çš„è¡¨æ ¼ï¼Œä»¥ç¡®å®šæ¯ä¸ªç¡¬ä»¶çº§åˆ«æ”¯æŒçš„æœ€å¤§åˆ†è¾¨ç‡ã€‚å¦‚éœ€æŸ¥çœ‹å½“å‰è®¾å¤‡æ”¯æŒçš„ç‰¹å®šåˆ†è¾¨ç‡ï¼Œè¯·å‚é˜… <a target="_blank" rel="noopener" href="https://developer.android.google.cn/reference/android/hardware/camera2/params/StreamConfigurationMap?hl=zh-cn#getOutputSizes(int)"><code>StreamConfigurationMap.getOutputSizes(int)</code></a>ã€‚</p>
<p>å¦‚æœæ‚¨çš„åº”ç”¨åœ¨ Android 10 æˆ–æ›´é«˜ç‰ˆæœ¬ä¸Šè¿è¡Œï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ <a target="_blank" rel="noopener" href="https://developer.android.google.cn/reference/android/hardware/camera2/CameraDevice?hl=zh-cn#isSessionConfigurationSupported(android.hardware.camera2.params.SessionConfiguration)"><code>isSessionConfigurationSupported()</code></a> éªŒè¯ç‰¹å®šçš„ <code>SessionConfiguration</code>ã€‚</p>
<h3 id="æ§åˆ¶æ‘„åƒå¤´è¾“å‡º"><a href="#æ§åˆ¶æ‘„åƒå¤´è¾“å‡º" class="headerlink" title="æ§åˆ¶æ‘„åƒå¤´è¾“å‡º"></a>æ§åˆ¶æ‘„åƒå¤´è¾“å‡º</h3><p>CameraX ä¸ä»…è®©æ‚¨å¯ä»¥è§†éœ€è¦ä¸ºæ¯ä¸ªå•ç‹¬çš„ç”¨ä¾‹é…ç½®æ‘„åƒå¤´è¾“å‡ºï¼Œè¿˜å®ç°äº†ä»¥ä¸‹æ¥å£ï¼Œä»è€Œæ”¯æŒæ‰€æœ‰ç»‘å®šç”¨ä¾‹ä¸­é€šç”¨çš„æ‘„åƒå¤´æ“ä½œï¼š</p>
<ul>
<li>åˆ©ç”¨ <a target="_blank" rel="noopener" href="https://developer.android.google.cn/reference/androidx/camera/core/CameraControl?hl=zh-cn"><code>CameraControl</code></a>ï¼Œæ‚¨å¯ä»¥é…ç½®é€šç”¨æ‘„åƒå¤´åŠŸèƒ½ã€‚</li>
<li>åˆ©ç”¨ <a target="_blank" rel="noopener" href="https://developer.android.google.cn/reference/androidx/camera/core/CameraInfo?hl=zh-cn"><code>CameraInfo</code></a>ï¼Œæ‚¨å¯ä»¥æŸ¥è¯¢è¿™äº›é€šç”¨æ‘„åƒå¤´åŠŸèƒ½çš„çŠ¶æ€ã€‚</li>
</ul>
<p>ä»¥ä¸‹æ˜¯ CameraControl æ”¯æŒçš„æ‘„åƒå¤´åŠŸèƒ½ï¼š</p>
<ul>
<li>å˜ç„¦</li>
<li>æ‰‹ç”µç­’</li>
<li>å¯¹ç„¦å’Œæµ‹å…‰ï¼ˆç‚¹æŒ‰å³å¯å¯¹ç„¦ï¼‰</li>
<li>æ›å…‰è¡¥å¿</li>
</ul>
<h4 id="è·å–-CameraControl-å’Œ-CameraInfo-çš„å®ä¾‹"><a href="#è·å–-CameraControl-å’Œ-CameraInfo-çš„å®ä¾‹" class="headerlink" title="è·å– CameraControl å’Œ CameraInfo çš„å®ä¾‹"></a>è·å– CameraControl å’Œ CameraInfo çš„å®ä¾‹</h4><p>ä½¿ç”¨ <a target="_blank" rel="noopener" href="https://developer.android.google.cn/reference/androidx/camera/lifecycle/ProcessCameraProvider?hl=zh-cn"><code>ProcessCameraProvider.bindToLifecycle()</code></a> è¿”å›çš„ <a target="_blank" rel="noopener" href="https://developer.android.google.cn/reference/androidx/camera/core/Camera?hl=zh-cn"><code>Camera</code></a> å¯¹è±¡æ£€ç´¢ <code>CameraControl</code> å’Œ <code>CameraInfo</code> çš„å®ä¾‹ã€‚ ä»¥ä¸‹ä»£ç å±•ç¤ºäº†ä¸€ä¸ªç¤ºä¾‹ï¼š</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> camera = processCameraProvider.bindToLifecycle(lifecycleOwner, cameraSelector, preview)</span><br><span class="line"></span><br><span class="line"><span class="comment">// For performing operations that affect all outputs.</span></span><br><span class="line"><span class="keyword">val</span> cameraControl = camera.cameraControl</span><br><span class="line"><span class="comment">// For querying information and states.</span></span><br><span class="line"><span class="keyword">val</span> cameraInfo = camera.cameraInfo</span><br></pre></td></tr></table></figure>

<p>ä¾‹å¦‚ï¼Œæ‚¨å¯ä»¥åœ¨è°ƒç”¨ <code>bindToLifecycle()</code> åæäº¤å˜ç„¦æ“ä½œåŠå…¶ä»– <code>CameraControl</code> æ“ä½œã€‚å¦‚æœæ‚¨åœæ­¢æˆ–é”€æ¯ç”¨äºç»‘å®šæ‘„åƒå¤´å®ä¾‹çš„ activityï¼Œ<code>CameraControl</code> æ— æ³•å†æ‰§è¡Œæ“ä½œï¼Œå¹¶ä¸”ä¼šè¿”å›å¤±è´¥çš„ <code>ListenableFuture</code>ã€‚</p>
<p><strong>æ³¨æ„ï¼š</strong>å¦‚æœ <a target="_blank" rel="noopener" href="https://developer.android.google.cn/reference/androidx/lifecycle/LifecycleOwner?hl=zh-cn"><code>LifecycleOwner</code></a> è¢«åœæ­¢æˆ–é”€æ¯ï¼Œ<code>Camera</code> å°±ä¼šå…³é—­ï¼Œä¹‹åå˜ç„¦ã€æ‰‹ç”µç­’ã€å¯¹ç„¦å’Œæµ‹å…‰ä»¥åŠæ›å…‰è¡¥å¿æ§ä»¶çš„æ‰€æœ‰çŠ¶æ€æ›´æ”¹å‡ä¼šè¿˜åŸæˆé»˜è®¤å€¼ã€‚</p>
<h4 id="å¯¹ç„¦å’Œæµ‹å…‰"><a href="#å¯¹ç„¦å’Œæµ‹å…‰" class="headerlink" title="å¯¹ç„¦å’Œæµ‹å…‰"></a>å¯¹ç„¦å’Œæµ‹å…‰</h4><p><a target="_blank" rel="noopener" href="https://developer.android.google.cn/reference/androidx/camera/core/CameraControl?hl=zh-cn#setExposureCompensationIndex(int)"><code>CameraControl.startFocusAndMetering()</code></a> å¯æ ¹æ®æŒ‡å®šçš„ FocusMeteringAction è®¾ç½® AF&#x2F;AE&#x2F;AWB æµ‹å…‰åŒºåŸŸï¼Œä»¥è§¦å‘è‡ªåŠ¨å¯¹ç„¦å’Œæ›å…‰æµ‹å…‰ã€‚æœ‰è®¸å¤šæ‘„åƒå¤´åº”ç”¨é€šè¿‡è¿™ç§æ–¹å¼å®ç°â€œç‚¹æŒ‰å¯¹ç„¦â€åŠŸèƒ½ã€‚</p>
<p><strong>MeteringPoint</strong></p>
<p>é¦–å…ˆï¼Œä½¿ç”¨ <a target="_blank" rel="noopener" href="https://developer.android.google.cn/reference/androidx/camera/core/MeteringPointFactory#createPoint(float,%20float,%20float)"><code>MeteringPointFactory.createPoint(float x, float y, float size)</code></a> åˆ›å»º <a target="_blank" rel="noopener" href="https://developer.android.google.cn/reference/androidx/camera/core/MeteringPoint?hl=zh-cn"><code>MeteringPoint</code></a>ã€‚ <code>MeteringPoint</code> è¡¨ç¤ºæ‘„åƒå¤´ <a target="_blank" rel="noopener" href="https://developer.android.google.cn/reference/android/view/Surface?hl=zh-cn"><code>Surface</code></a> ä¸Šçš„å•ä¸ªç‚¹ã€‚å®ƒä»¥æ ‡å‡†åŒ–å½¢å¼å­˜å‚¨ï¼Œæ‰€ä»¥èƒ½è½»æ¾è½¬æ¢ä¸ºä¼ æ„Ÿå™¨åæ ‡ï¼Œä»è€Œç”¨äºæŒ‡å®š AF&#x2F;AE&#x2F;AWB åŒºåŸŸã€‚</p>
<p><code>MeteringPoint</code> çš„å¤§å°ä»‹äº 0 åˆ° 1 ä¹‹é—´ï¼Œé»˜è®¤å¤§å°ä¸º 0.15fã€‚è°ƒç”¨ <code>MeteringPointFactory.createPoint(float x, float y, float size)</code> æ—¶ï¼ŒCameraX ä¼šä¸ºæä¾›çš„ <code>size</code> åˆ›å»ºä»¥ <code>(x, y)</code> ä¸ºä¸­å¿ƒçš„çŸ©å½¢åŒºåŸŸã€‚</p>
<p>ä¸‹é¢çš„ä»£ç æ¼”ç¤ºäº†å¦‚ä½•åˆ›å»º <code>MeteringPoint</code>ï¼š</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Use PreviewView.getMeteringPointFactory if PreviewView is used for preview.</span></span><br><span class="line">previewView.setOnTouchListener((view, motionEvent) -&gt;  &#123;</span><br><span class="line"><span class="keyword">val</span> meteringPoint = previewView.meteringPointFactory</span><br><span class="line">    .createPoint(motionEvent.x, motionEvent.y)</span><br><span class="line">â€¦</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Use DisplayOrientedMeteringPointFactory if SurfaceView / TextureView is used for</span></span><br><span class="line"><span class="comment">// preview. Please note that if the preview is scaled or cropped in the View,</span></span><br><span class="line"><span class="comment">// itâ€™s the application&#x27;s responsibility to transform the coordinates properly</span></span><br><span class="line"><span class="comment">// so that the width and height of this factory represents the full Preview FOV.</span></span><br><span class="line"><span class="comment">// And the (x,y) passed to create MeteringPoint might need to be adjusted with</span></span><br><span class="line"><span class="comment">// the offsets.</span></span><br><span class="line"><span class="keyword">val</span> meteringPointFactory = DisplayOrientedMeteringPointFactory(</span><br><span class="line">     surfaceView.display,</span><br><span class="line">     camera.cameraInfo,</span><br><span class="line">     surfaceView.width,</span><br><span class="line">     surfaceView.height</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">// Use SurfaceOrientedMeteringPointFactory if the point is specified in</span></span><br><span class="line"><span class="comment">// ImageAnalysis ImageProxy.</span></span><br><span class="line"><span class="keyword">val</span> meteringPointFactory = SurfaceOrientedMeteringPointFactory(</span><br><span class="line">     imageWidth,</span><br><span class="line">     imageHeight,</span><br><span class="line">     imageAnalysis)</span><br></pre></td></tr></table></figure>

<p><strong>startFocusAndMetering å’Œ FocusMeteringAction</strong></p>
<p>å¦‚éœ€è°ƒç”¨ <a target="_blank" rel="noopener" href="https://developer.android.google.cn/reference/androidx/camera/core/CameraControl?hl=zh-cn#startFocusAndMetering(androidx.camera.core.FocusMeteringAction)"><code>startFocusAndMetering()</code></a>ï¼Œåº”ç”¨å¿…é¡»æ„å»º <a target="_blank" rel="noopener" href="https://developer.android.google.cn/reference/androidx/camera/core/FocusMeteringAction?hl=zh-cn"><code>FocusMeteringAction</code></a>ï¼Œå…¶ä¸­åŒ…å«ä¸€ä¸ªæˆ–å¤šä¸ª <code>MeteringPoints</code>ï¼Œåè€…ç”± <a target="_blank" rel="noopener" href="https://developer.android.google.cn/reference/androidx/camera/core/FocusMeteringAction?hl=zh-cn#FLAG_AF"><code>FLAG_AF</code></a>ã€<a target="_blank" rel="noopener" href="https://developer.android.google.cn/reference/androidx/camera/core/FocusMeteringAction?hl=zh-cn#FLAG_AE"><code>FLAG_AE</code></a>ã€<a target="_blank" rel="noopener" href="https://developer.android.google.cn/reference/androidx/camera/core/FocusMeteringAction?hl=zh-cn#FLAG_AWB"><code>FLAG_AWB</code></a> è¿™äº›å¯é€‰æµ‹å…‰æ¨¡å¼ç»„åˆè€Œæˆã€‚ä¸‹é¢çš„ä»£ç æ¼”ç¤ºäº†è¿™ä¸€ç”¨æ³•ï¼š</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> meteringPoint1 = meteringPointFactory.createPoint(x1, x1)</span><br><span class="line"><span class="keyword">val</span> meteringPoint2 = meteringPointFactory.createPoint(x2, y2)</span><br><span class="line"><span class="keyword">val</span> action = FocusMeteringAction.Builder(meteringPoint1) <span class="comment">// default AF|AE|AWB</span></span><br><span class="line">      <span class="comment">// Optionally add meteringPoint2 for AF/AE.</span></span><br><span class="line">      .addPoint(meteringPoint2, FLAG_AF | FLAG_AE)</span><br><span class="line">      <span class="comment">// The action is canceled in 3 seconds (if not set, default is 5s).</span></span><br><span class="line">      .setAutoCancelDuration(<span class="number">3</span>, TimeUnit.SECONDS)</span><br><span class="line">      .build()</span><br><span class="line"></span><br><span class="line"><span class="keyword">val</span> result = cameraControl.startFocusAndMetering(action)</span><br><span class="line"><span class="comment">// Adds listener to the ListenableFuture if you need to know the focusMetering result.</span></span><br><span class="line">result.addListener(&#123;</span><br><span class="line">   <span class="comment">// result.get().isFocusSuccessful returns if the auto focus is successful or not.</span></span><br><span class="line">&#125;, ContextCompat.getMainExecutor(<span class="keyword">this</span>)</span><br></pre></td></tr></table></figure>

<p>å¦‚ä¸Šé¢çš„ä»£ç æ‰€ç¤ºï¼Œ<a target="_blank" rel="noopener" href="https://developer.android.google.cn/reference/androidx/camera/core/CameraControl?hl=zh-cn#startFocusAndMetering(androidx.camera.core.FocusMeteringAction)"><code>startFocusAndMetering()</code></a> æ¥å—ä¸€ä¸ª <code>FocusMeteringAction</code>ï¼Œåè€…åŒ…å«ä¸€ä¸ªç”¨äº AF&#x2F;AE&#x2F;AWB æµ‹å…‰åŒºåŸŸçš„ <code>MeteringPoint</code>ï¼Œä»¥åŠå¦ä¸€ä¸ªä»…ç”¨äº AF å’Œ AE çš„ MeteringPointã€‚</p>
<p>åœ¨å†…éƒ¨ï¼ŒCameraX ä¼šå°†å…¶è½¬æ¢ä¸º Camera2 <a target="_blank" rel="noopener" href="https://developer.android.google.cn/reference/android/hardware/camera2/params/MeteringRectangle?hl=zh-cn"><code>MeteringRectangles</code></a>ï¼Œå¹¶å°†ç›¸åº”çš„ <a target="_blank" rel="noopener" href="https://developer.android.google.cn/reference/android/hardware/camera2/CaptureRequest?hl=zh-cn#CONTROL_AF_REGIONS"><code>CONTROL_AF_REGIONS</code></a>&#x2F;<a target="_blank" rel="noopener" href="https://developer.android.google.cn/reference/android/hardware/camera2/CaptureRequest?hl=zh-cn#CONTROL_AE_REGIONS"><code>CONTROL_AE_REGIONS</code></a>&#x2F;<a target="_blank" rel="noopener" href="https://developer.android.google.cn/reference/android/hardware/camera2/CaptureRequest?hl=zh-cn#CONTROL_AWB_REGIONS"><code>CONTROL_AWB_REGIONS</code></a> å‚æ•°è®¾ç½®ä¸ºæ‹æ‘„è¯·æ±‚ã€‚</p>
<p>ç”±äºå¹¶éæ‰€æœ‰è®¾å¤‡éƒ½æ”¯æŒ AF&#x2F;AE&#x2F;AWB å’Œå¤šä¸ªåŒºåŸŸï¼ŒCameraX ä¼šå°½æœ€å¤§åŠªåŠ›æ‰§è¡Œ <code>FocusMeteringAction</code>ã€‚CameraX ä¼šä½¿ç”¨æ‰€æ”¯æŒçš„æœ€å¤§æ•°é‡çš„ MeteringPointï¼Œå¹¶æŒ‰æµ‹å…‰ç‚¹çš„æ·»åŠ é¡ºåºä¾æ¬¡ä½¿ç”¨ã€‚å¯¹äºåœ¨è¶…å‡ºæ”¯æŒçš„æœ€å¤§æ•°é‡ä¹‹å¤–æ·»åŠ çš„æ‰€æœ‰ MeteringPointï¼ŒCameraX ä¼šä¸€å¾‹å¿½ç•¥ã€‚ä¾‹å¦‚ï¼Œå¦‚æœæ‚¨åœ¨ä»…æ”¯æŒ 2 ä¸ª MeteringPoint çš„å¹³å°ä¸Šä¸º <code>FocusMeteringAction</code> æä¾› 3 ä¸ª MeteringPointï¼Œé‚£ä¹ˆ CameraX åªä¼šä½¿ç”¨å‰ 2 ä¸ª MeteringPointï¼Œå¹¶å¿½ç•¥æœ€åä¸€ä¸ª <code>MeteringPoint</code>ã€‚</p>
<h2 id="å›¾åƒåˆ†æ"><a href="#å›¾åƒåˆ†æ" class="headerlink" title="å›¾åƒåˆ†æ"></a>å›¾åƒåˆ†æ</h2><p><a target="_blank" rel="noopener" href="https://developer.android.google.cn/reference/androidx/camera/core/ImageAnalysis.Analyzer?hl=zh-cn#analyze(androidx.camera.core.ImageProxy)">å›¾åƒåˆ†æ</a>ç”¨ä¾‹ä¸ºæ‚¨çš„åº”ç”¨æä¾›å¯ä¾› CPU è®¿é—®çš„å›¾åƒï¼Œæ‚¨å¯ä»¥å¯¹è¿™äº›å›¾åƒæ‰§è¡Œå›¾åƒå¤„ç†ã€è®¡ç®—æœºè§†è§‰æˆ–æœºå™¨å­¦ä¹ æ¨æ–­ã€‚åº”ç”¨ä¼šå®ç°å¯¹æ¯ä¸ªå¸§è¿è¡Œçš„ <a target="_blank" rel="noopener" href="https://developer.android.google.cn/reference/androidx/camera/core/ImageAnalysis.Analyzer?hl=zh-cn#analyze(androidx.camera.core.ImageProxy)"><code>analyze()</code></a> æ–¹æ³•ã€‚</p>
<p>å¦‚éœ€äº†è§£å¦‚ä½•å°† Google çš„æœºå™¨å­¦ä¹ å¥—ä»¶ä¸ CameraX åº”ç”¨é›†æˆï¼Œè¯·å‚é˜…<a target="_blank" rel="noopener" href="https://developer.android.google.cn/training/camerax/mlkitanalyzer?hl=zh-cn">æœºå™¨å­¦ä¹ å¥—ä»¶åˆ†æå™¨</a>ã€‚</p>
<h3 id="æ“ä½œæ¨¡å¼"><a href="#æ“ä½œæ¨¡å¼" class="headerlink" title="æ“ä½œæ¨¡å¼"></a>æ“ä½œæ¨¡å¼</h3><p>å½“åº”ç”¨çš„åˆ†ææµæ°´çº¿æ— æ³•æ»¡è¶³ CameraX çš„å¸§é€Ÿç‡è¦æ±‚æ—¶ï¼Œæ‚¨å¯ä»¥å°† CameraX é…ç½®ä¸ºé€šè¿‡ä»¥ä¸‹å…¶ä¸­ä¸€ç§æ–¹å¼ä¸¢å¸§ï¼š</p>
<ul>
<li><strong>éé˜»å¡</strong>ï¼ˆé»˜è®¤ï¼‰ï¼šåœ¨è¯¥æ¨¡å¼ä¸‹ï¼Œæ‰§è¡Œå™¨å§‹ç»ˆä¼šå°†æœ€æ–°çš„å›¾åƒç¼“å­˜åˆ°å›¾åƒç¼“å†²åŒºï¼ˆä¸æ·±åº¦ä¸º 1 çš„é˜Ÿåˆ—ç›¸ä¼¼ï¼‰ï¼Œä¸æ­¤åŒæ—¶ï¼Œåº”ç”¨ä¼šåˆ†æä¸Šä¸€ä¸ªå›¾åƒã€‚å¦‚æœ CameraX åœ¨åº”ç”¨å®Œæˆå¤„ç†ä¹‹å‰æ”¶åˆ°æ–°å›¾åƒï¼Œåˆ™æ–°å›¾åƒä¼šä¿å­˜åˆ°åŒä¸€ç¼“å†²åŒºï¼Œå¹¶è¦†ç›–ä¸Šä¸€ä¸ªå›¾åƒã€‚ è¯·æ³¨æ„ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œ<code>ImageAnalysis.Builder.setImageQueueDepth()</code> ä¸èµ·ä»»ä½•ä½œç”¨ï¼Œç¼“å†²åŒºå†…å®¹å§‹ç»ˆä¼šè¢«è¦†ç›–ã€‚æ‚¨å¯ä»¥é€šè¿‡ä½¿ç”¨ <a target="_blank" rel="noopener" href="https://developer.android.google.cn/reference/androidx/camera/core/ImageAnalysis?hl=zh-cn#STRATEGY_KEEP_ONLY_LATEST"><code>STRATEGY_KEEP_ONLY_LATEST</code></a> è°ƒç”¨ <code>setBackpressureStrategy()</code> æ¥å¯ç”¨è¯¥éé˜»å¡æ¨¡å¼ã€‚å¦‚éœ€è¯¦ç»†äº†è§£æ‰§è¡Œå™¨çš„ç›¸å…³å½±å“ï¼Œè¯·å‚é˜… <a target="_blank" rel="noopener" href="https://developer.android.google.cn/reference/androidx/camera/core/ImageAnalysis?hl=zh-cn#STRATEGY_KEEP_ONLY_LATEST"><code>STRATEGY_KEEP_ONLY_LATEST</code></a> çš„å‚è€ƒæ–‡æ¡£ã€‚</li>
<li><strong>é˜»å¡</strong>ï¼šåœ¨è¯¥æ¨¡å¼ä¸‹ï¼Œå†…éƒ¨æ‰§è¡Œå™¨å¯ä»¥å‘å†…éƒ¨å›¾åƒé˜Ÿåˆ—æ·»åŠ å¤šä¸ªå›¾åƒï¼Œå¹¶ä»…åœ¨é˜Ÿåˆ—å·²æ»¡æ—¶æ‰å¼€å§‹ä¸¢å¸§ã€‚ç³»ç»Ÿä¼šåœ¨æ•´ä¸ªç›¸æœºè®¾å¤‡ä¸Šè¿›è¡Œå±è”½ï¼šå¦‚æœç›¸æœºè®¾å¤‡å…·æœ‰å¤šä¸ªç»‘å®šç”¨ä¾‹ï¼Œé‚£ä¹ˆåœ¨ CameraX å¤„ç†è¿™äº›å›¾åƒæ—¶ï¼Œç³»ç»Ÿä¼šå±è”½æ‰€æœ‰è¿™äº›ç”¨ä¾‹ã€‚ä¾‹å¦‚ï¼Œå¦‚æœé¢„è§ˆå’Œå›¾åƒåˆ†æéƒ½å·²ç»‘å®šåˆ°æŸä¸ªç›¸æœºè®¾å¤‡ï¼Œé‚£ä¹ˆåœ¨ CameraX å¤„ç†å›¾åƒæ—¶ï¼Œç³»ç»Ÿä¹Ÿä¼šå±è”½ç›¸åº”é¢„è§ˆã€‚æ‚¨å¯ä»¥é€šè¿‡å°† <a target="_blank" rel="noopener" href="https://developer.android.google.cn/reference/androidx/camera/core/ImageAnalysis?hl=zh-cn#strategy_block_producer"><code>STRATEGY_BLOCK_PRODUCER</code></a> ä¼ é€’åˆ° <a target="_blank" rel="noopener" href="https://developer.android.google.cn/reference/androidx/camera/core/ImageAnalysis.Builder?hl=zh-cn#setBackpressureStrategy(int)"><code>setBackpressureStrategy()</code></a> æ¥å¯ç”¨é˜»å¡æ¨¡å¼ã€‚æ­¤å¤–ï¼Œæ‚¨è¿˜å¯ä»¥é€šè¿‡ä½¿ç”¨ <a target="_blank" rel="noopener" href="https://developer.android.google.cn/reference/androidx/camera/core/ImageAnalysis.Builder?hl=zh-cn#setImageQueueDepth(int)">ImageAnalysis.Builder.setImageQueueDepth()</a> æ¥é…ç½®å›¾åƒé˜Ÿåˆ—æ·±åº¦ã€‚</li>
</ul>
<p>å¦‚æœåˆ†æå™¨å»¶è¿Ÿä½ä¸”æ€§èƒ½é«˜ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ç”¨äºåˆ†æå›¾åƒçš„æ€»æ—¶é—´ä½äº CameraX å¸§çš„æ—¶é•¿ï¼ˆä¾‹å¦‚ï¼Œ60fps ç”¨æ—¶ 16 æ¯«ç§’ï¼‰ï¼Œé‚£ä¹ˆä¸Šè¿°ä¸¤ç§æ“ä½œæ¨¡å¼å‡å¯æä¾›é¡ºç•…çš„æ€»ä½“ä½“éªŒã€‚åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œé˜»å¡æ¨¡å¼ä»éå¸¸æœ‰ç”¨ï¼Œä¾‹å¦‚åœ¨å¤„ç†éå¸¸çŸ­æš‚çš„ç³»ç»ŸæŠ–åŠ¨æ—¶ã€‚</p>
<p>å¦‚æœåˆ†æå™¨å»¶è¿Ÿé«˜ä¸”æ€§èƒ½é«˜ï¼Œåˆ™éœ€è¦ç»“åˆä½¿ç”¨é˜»å¡æ¨¡å¼å’Œè¾ƒé•¿çš„é˜Ÿåˆ—æ¥æŠµè¡¥å»¶è¿Ÿã€‚ä½†è¯·æ³¨æ„ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œåº”ç”¨ä»å¯ä»¥å¤„ç†æ‰€æœ‰å¸§ã€‚</p>
<p>å¦‚æœåˆ†æå™¨å»¶è¿Ÿé«˜ä¸”è€—æ—¶é•¿ï¼ˆåˆ†æå™¨æ— æ³•å¤„ç†æ‰€æœ‰å¸§ï¼‰ï¼Œéé˜»å¡æ¨¡å¼å¯èƒ½æ›´ä¸ºé€‚ç”¨ï¼Œå› ä¸ºåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œç³»ç»Ÿå¿…é¡»é’ˆå¯¹åˆ†æè·¯å¾„è¿›è¡Œä¸¢å¸§ï¼Œä½†è¦è®©å…¶ä»–åŒæ—¶ç»‘å®šçš„ç”¨ä¾‹ä»èƒ½çœ‹åˆ°æ‰€æœ‰å¸§ã€‚</p>
<h3 id="å®ç°"><a href="#å®ç°" class="headerlink" title="å®ç°"></a>å®ç°</h3><p>å¦‚éœ€åœ¨æ‚¨çš„åº”ç”¨ä¸­ä½¿ç”¨å›¾åƒåˆ†æï¼Œè¯·æŒ‰ä»¥ä¸‹æ­¥éª¤æ“ä½œï¼š</p>
<ul>
<li>æ„å»º <a target="_blank" rel="noopener" href="https://developer.android.google.cn/reference/androidx/camera/core/ImageAnalysis?hl=zh-cn"><code>ImageAnalysis</code></a> ç”¨ä¾‹ã€‚</li>
<li>åˆ›å»º <a target="_blank" rel="noopener" href="https://developer.android.google.cn/reference/androidx/camera/core/ImageAnalysis.Analyzer?hl=zh-cn"><code>ImageAnalysis.Analyzer</code></a>ã€‚</li>
<li><a target="_blank" rel="noopener" href="https://developer.android.google.cn/reference/androidx/camera/core/ImageAnalysis#setAnalyzer(java.util.concurrent.Executor,%20androidx.camera.core.ImageAnalysis.Analyzer)">å°†åˆ†æå™¨è®¾ä¸º</a> <code>ImageAnalysis</code>ã€‚</li>
<li>å°†ç”Ÿå‘½å‘¨æœŸæ‰€æœ‰è€…ã€ç›¸æœºé€‰æ‹©å™¨å’Œ <code>ImageAnalysis</code> ç”¨ä¾‹<a target="_blank" rel="noopener" href="https://developer.android.google.cn/reference/androidx/camera/lifecycle/ProcessCameraProvider#bindToLifecycle(androidx.lifecycle.LifecycleOwner,%20androidx.camera.core.CameraSelector,%20androidx.camera.core.UseCase...)">ç»‘å®š</a>åˆ°ç”Ÿå‘½å‘¨æœŸã€‚</li>
</ul>
<p>ç»‘å®šåï¼ŒCameraX ä¼šç«‹å³å°†å›¾åƒå‘é€åˆ°å·²æ³¨å†Œçš„åˆ†æå™¨ã€‚ å®Œæˆåˆ†æåï¼Œè°ƒç”¨ <a target="_blank" rel="noopener" href="https://developer.android.google.cn/reference/androidx/camera/core/ImageAnalysis?hl=zh-cn#clearAnalyzer()"><code>ImageAnalysis.clearAnalyzer()</code></a> æˆ–è§£é™¤ç»‘å®š <code>ImageAnalysis</code> ç”¨ä¾‹ä»¥åœæ­¢åˆ†æã€‚</p>
<h4 id="æ„å»º-ImageAnalysis-ç”¨ä¾‹"><a href="#æ„å»º-ImageAnalysis-ç”¨ä¾‹" class="headerlink" title="æ„å»º ImageAnalysis ç”¨ä¾‹"></a>æ„å»º ImageAnalysis ç”¨ä¾‹</h4><p><a target="_blank" rel="noopener" href="https://developer.android.google.cn/reference/androidx/camera/core/ImageAnalysis?hl=zh-cn"><code>ImageAnalysis</code></a> å¯å°†åˆ†æå™¨ï¼ˆå›¾åƒä½¿ç”¨æ–¹ï¼‰è¿æ¥åˆ° CameraXï¼ˆå›¾åƒç”Ÿæˆæ–¹ï¼‰ã€‚åº”ç”¨å¯ä»¥ä½¿ç”¨ <a target="_blank" rel="noopener" href="https://developer.android.google.cn/reference/androidx/camera/core/ImageAnalysis.Builder?hl=zh-cn"><code>ImageAnalysis.Builder</code></a> æ¥æ„å»º <code>ImageAnalysis</code> å¯¹è±¡ã€‚å€ŸåŠ© <code>ImageAnalysis.Builder</code>ï¼Œåº”ç”¨å¯ä»¥è¿›è¡Œä»¥ä¸‹é…ç½®ï¼š</p>
<ul>
<li>å›¾åƒè¾“å‡ºå‚æ•°ï¼š<ul>
<li>æ ¼å¼ï¼šCameraX å¯é€šè¿‡ <a target="_blank" rel="noopener" href="https://developer.android.google.cn/reference/kotlin/androidx/camera/core/ImageAnalysis.Builder?hl=zh-cn#setOutputImageFormat(kotlin.Int)"><code>setOutputImageFormat(int)</code></a> æ”¯æŒ <a target="_blank" rel="noopener" href="https://developer.android.google.cn/reference/androidx/camera/core/ImageAnalysis?hl=zh-cn#OUTPUT_IMAGE_FORMAT_YUV_420_888"><code>YUV_420_888</code></a> å’Œ <a target="_blank" rel="noopener" href="https://developer.android.google.cn/reference/androidx/camera/core/ImageAnalysis?hl=zh-cn#OUTPUT_IMAGE_FORMAT_RGBA_8888"><code>RGBA_8888</code></a>ã€‚é»˜è®¤æ ¼å¼ä¸º <code>YUV_420_888</code>ã€‚</li>
<li><a target="_blank" rel="noopener" href="https://developer.android.google.cn/reference/androidx/camera/core/ImageAnalysis.Builder?hl=zh-cn#setTargetResolution(android.util.Size)">Resolution</a> å’Œ <a target="_blank" rel="noopener" href="https://developer.android.google.cn/reference/androidx/camera/core/ImageAnalysis.Builder?hl=zh-cn#setTargetAspectRatio(int)">AspectRatio</a>ï¼šæ‚¨å¯ä»¥è®¾ç½®å…¶ä¸­ä¸€ä¸ªå‚æ•°ï¼Œä½†è¯·æ³¨æ„ï¼Œæ‚¨ä¸èƒ½åŒæ—¶è®¾ç½®è¿™ä¸¤ä¸ªå€¼ã€‚</li>
<li><a target="_blank" rel="noopener" href="https://developer.android.google.cn/reference/androidx/camera/core/ImageAnalysis.Builder?hl=zh-cn#setTargetRotation(int)">æ—‹è½¬è§’åº¦</a>ã€‚</li>
<li><a target="_blank" rel="noopener" href="https://developer.android.google.cn/reference/androidx/camera/core/ImageAnalysis.Builder?hl=zh-cn#setTargetName(java.lang.String)">ç›®æ ‡åç§°</a>ï¼šä½¿ç”¨è¯¥å‚æ•°è¿›è¡Œè°ƒè¯•ã€‚</li>
</ul>
</li>
<li>å›¾åƒæµæ§åˆ¶ï¼š<ul>
<li><a target="_blank" rel="noopener" href="https://developer.android.google.cn/reference/androidx/camera/core/ImageAnalysis.Builder?hl=zh-cn#setBackgroundExecutor(java.util.concurrent.Executor)">åå°æ‰§è¡Œå™¨</a></li>
<li><a target="_blank" rel="noopener" href="https://developer.android.google.cn/reference/androidx/camera/core/ImageAnalysis.Builder?hl=zh-cn#setImageQueueDepth(int)">å›¾åƒé˜Ÿåˆ—æ·±åº¦ï¼ˆåˆ†æå™¨å’Œ CamaraX ä¹‹é—´ï¼‰</a></li>
<li><a target="_blank" rel="noopener" href="https://developer.android.google.cn/reference/androidx/camera/core/ImageAnalysis.Builder?hl=zh-cn#setBackpressureStrategy(int)">èƒŒå‹ç­–ç•¥</a></li>
</ul>
</li>
</ul>
<p>åº”ç”¨å¯ä»¥è®¾ç½®åˆ†è¾¨ç‡æˆ–å®½é«˜æ¯”ï¼Œä½†ä¸èƒ½åŒæ—¶è®¾ç½®è¿™ä¸¤ä¸ªå€¼ã€‚ç¡®åˆ‡çš„è¾“å‡ºåˆ†è¾¨ç‡å–å†³äºåº”ç”¨è¯·æ±‚çš„å¤§å°ï¼ˆæˆ–å®½é«˜æ¯”ï¼‰å’Œç¡¬ä»¶åŠŸèƒ½ï¼Œå¹¶å¯èƒ½ä¸è¯·æ±‚çš„å¤§å°æˆ–å®½é«˜æ¯”ä¸åŒã€‚å¦‚éœ€äº†è§£åˆ†è¾¨ç‡åŒ¹é…ç®—æ³•ï¼Œè¯·å‚é˜…æœ‰å…³ <a target="_blank" rel="noopener" href="https://developer.android.google.cn/reference/androidx/camera/core/ImageAnalysis.Builder?hl=zh-cn#setTargetResolution(android.util.Size)"><code>setTargetResolution()</code></a> çš„æ–‡æ¡£</p>
<p>åº”ç”¨å¯ä»¥å°†è¾“å‡ºå›¾åƒåƒç´ é…ç½®ä¸ºé‡‡ç”¨ YUVï¼ˆé»˜è®¤ï¼‰æˆ– RGBA é¢œè‰²ç©ºé—´ã€‚è®¾ç½® RGBA è¾“å‡ºæ ¼å¼æ—¶ï¼ŒCameraX ä¼šåœ¨å†…éƒ¨å°†å›¾åƒä» YUV é¢œè‰²ç©ºé—´è½¬æ¢ä¸º RGBA é¢œè‰²ç©ºé—´ï¼Œå¹¶å°†å›¾åƒä½æ‰“åŒ…åˆ° ImageProxy ç¬¬ä¸€ä¸ªå¹³é¢ï¼ˆå…¶ä»–ä¸¤ä¸ªå¹³é¢æœªä½¿ç”¨ï¼‰çš„ <a target="_blank" rel="noopener" href="https://developer.android.google.cn/reference/androidx/camera/core/ImageProxy.PlaneProxy?hl=zh-cn#getBuffer()"><code>ByteBuffer</code></a> ä¸­ï¼Œåºåˆ—å¦‚ä¸‹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ImageProxy.getPlanes()[0].buffer[0]: alpha</span><br><span class="line">ImageProxy.getPlanes()[0].buffer[1]: red</span><br><span class="line">ImageProxy.getPlanes()[0].buffer[2]: green</span><br><span class="line">ImageProxy.getPlanes()[0].buffer[3]: blue</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<p>åœ¨æ‰§è¡Œè®¾å¤‡æ— æ³•æ»¡è¶³å¸§é€Ÿç‡è¦æ±‚çš„å¤æ‚å›¾åƒåˆ†ææ—¶ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨æœ¬ä¸»é¢˜çš„<a target="_blank" rel="noopener" href="https://developer.android.google.cn/training/camerax/analyze?hl=zh-cn#operating_modes">æ“ä½œæ¨¡å¼</a>éƒ¨åˆ†æ‰€è¿°çš„ç­–ç•¥å°† CameraX é…ç½®ä¸ºä¸¢å¸§ã€‚</p>
<h4 id="åˆ›å»ºåˆ†æå™¨"><a href="#åˆ›å»ºåˆ†æå™¨" class="headerlink" title="åˆ›å»ºåˆ†æå™¨"></a>åˆ›å»ºåˆ†æå™¨</h4><p>åº”ç”¨å¯ä»¥é€šè¿‡å®ç° <a target="_blank" rel="noopener" href="https://developer.android.google.cn/reference/androidx/camera/core/ImageAnalysis.Analyzer?hl=zh-cn"><code>ImageAnalysis.Analyzer</code></a> æ¥å£å¹¶æ›¿æ¢ <a target="_blank" rel="noopener" href="https://developer.android.google.cn/reference/androidx/camera/core/ImageAnalysis.Analyzer?hl=zh-cn#analyze(androidx.camera.core.ImageProxy)"><code>analyze(ImageProxy image)</code></a> æ¥åˆ›å»ºåˆ†æå™¨ã€‚ åœ¨æ¯ä¸ªåˆ†æå™¨ä¸­ï¼Œåº”ç”¨éƒ½ä¼šæ”¶åˆ°ä¸€ä¸ª <a target="_blank" rel="noopener" href="https://developer.android.google.cn/reference/androidx/camera/core/ImageProxy?hl=zh-cn"><code>ImageProxy</code></a>ï¼Œå®ƒæ˜¯ <a target="_blank" rel="noopener" href="https://developer.android.google.cn/reference/android/media/Image?hl=zh-cn">Media.Image</a> çš„å°è£…å®¹å™¨ã€‚å¯ä»¥ä½¿ç”¨ <a target="_blank" rel="noopener" href="https://developer.android.google.cn/reference/androidx/camera/core/ImageProxy?hl=zh-cn#getFormat()"><code>ImageProxy.getFormat()</code></a> æ¥æŸ¥è¯¢å›¾åƒæ ¼å¼ã€‚è¯¥æ ¼å¼ä½¿ç”¨åº”ç”¨é€šè¿‡ <code>ImageAnalysis.Builder</code> æä¾›çš„ä»¥ä¸‹å€¼ä¹‹ä¸€è¡¨ç¤ºï¼š</p>
<ul>
<li>å¦‚æœåº”ç”¨è¯·æ±‚äº† <code>OUTPUT_IMAGE_FORMAT_RGBA_8888</code>ï¼Œåˆ™ä¸º <code>ImageFormat.RGBA_8888</code>ã€‚</li>
<li>å¦‚æœåº”ç”¨è¯·æ±‚äº† <code>OUTPUT_IMAGE_FORMAT_YUV_420_888</code>ï¼Œåˆ™ä¸º <code>ImageFormat.YUV_420_888</code>ã€‚</li>
</ul>
<p>å¦‚éœ€äº†è§£é¢œè‰²ç©ºé—´é…ç½®ä»¥åŠå¯æ£€ç´¢åƒç´ å­—èŠ‚çš„ä½ç½®ï¼Œè¯·å‚é˜…<a target="_blank" rel="noopener" href="https://developer.android.google.cn/training/camerax/analyze?hl=zh-cn#build_imageanalysis_use_case">æ„å»º ImageAnalysis ç”¨ä¾‹</a>ã€‚</p>
<p>åœ¨åˆ†æå™¨ä¸­ï¼Œåº”ç”¨åº”æ‰§è¡Œä»¥ä¸‹æ“ä½œï¼š</p>
<ol>
<li>å°½å¿«åˆ†æç»™å®šçš„å¸§ï¼Œæœ€å¥½åœ¨ç»™å®šçš„å¸§é€Ÿç‡æ—¶é—´é™åˆ¶å†…è¿›è¡Œåˆ†æï¼ˆä¾‹å¦‚ï¼Œå¦‚æœå¸§é€Ÿç‡ä¸º 30 fpsï¼Œåˆ™ç”¨æ—¶åº”ä½äº 32 æ¯«ç§’ï¼‰ã€‚å¦‚æœåº”ç”¨æ— æ³•è¶³å¤Ÿå¿«åœ°åˆ†æå¸§ï¼Œè¯·è€ƒè™‘é‡‡ç”¨ä¸€ç§<a target="_blank" rel="noopener" href="https://developer.android.google.cn/training/camerax/analyze?hl=zh-cn#operating_modes">å—æ”¯æŒçš„ä¸¢å¸§æœºåˆ¶</a>ã€‚</li>
<li>é€šè¿‡è°ƒç”¨ <a target="_blank" rel="noopener" href="https://developer.android.google.cn/reference/androidx/camera/core/ImageProxy?hl=zh-cn#close()"><code>ImageProxy.close()</code></a> å°† <code>ImageProxy</code> å‘å¸ƒåˆ° CameraXã€‚è¯·æ³¨æ„ï¼Œæ‚¨ä¸åº”è°ƒç”¨å·²å°è£… Media.Image çš„ close å‡½æ•° (<code>Media.Image.close()</code>)ã€‚</li>
</ol>
<p>åº”ç”¨å¯ä»¥ç›´æ¥ä½¿ç”¨ ImageProxy ä¸­çš„å·²å°è£… <code>Media.Image</code>ã€‚ è¯·ä¸è¦å¯¹å·²å°è£…çš„å›¾åƒè°ƒç”¨ <code>Media.Image.close()</code>ï¼Œå› ä¸ºè¿™ä¼šç ´å CameraX ä¸­çš„å›¾åƒåˆ†äº«æœºåˆ¶ï¼›è¯·æ”¹ä¸ºä½¿ç”¨ <a target="_blank" rel="noopener" href="https://developer.android.google.cn/reference/androidx/camera/core/ImageProxy?hl=zh-cn#close()"><code>ImageProxy.close()</code></a> å°†åº•å±‚ <code>Media.Image</code> å‘å¸ƒåˆ° CameraXã€‚</p>
<h4 id="é’ˆå¯¹-ImageAnalysis-é…ç½®åˆ†æå™¨"><a href="#é’ˆå¯¹-ImageAnalysis-é…ç½®åˆ†æå™¨" class="headerlink" title="é’ˆå¯¹ ImageAnalysis é…ç½®åˆ†æå™¨"></a>é’ˆå¯¹ ImageAnalysis é…ç½®åˆ†æå™¨</h4><p>åˆ›å»ºåˆ†æå™¨åï¼Œä½¿ç”¨ <a target="_blank" rel="noopener" href="https://developer.android.google.cn/reference/androidx/camera/core/ImageAnalysis#setAnalyzer(java.util.concurrent.Executor,%20androidx.camera.core.ImageAnalysis.Analyzer)"><code>ImageAnalysis.setAnalyzer()</code></a> æ³¨å†Œè¯¥åˆ†æå™¨ä»¥å¼€å§‹åˆ†æã€‚å®Œæˆåˆ†æåï¼Œä½¿ç”¨ <a target="_blank" rel="noopener" href="https://developer.android.google.cn/reference/androidx/camera/core/ImageAnalysis?hl=zh-cn#clearAnalyzer()"><code>ImageAnalysis.clearAnalyzer()</code></a> ç§»é™¤å·²æ³¨å†Œçš„åˆ†æå™¨ã€‚</p>
<p>æ‚¨åªèƒ½å°†ä¸€ä¸ªåˆ†æå™¨é…ç½®ä¸ºæ´»åŠ¨çŠ¶æ€ï¼Œç”¨äºåˆ†æå›¾åƒã€‚è°ƒç”¨ <code>ImageAnalysis.setAnalyzer()</code> ä¼šæ›¿æ¢å·²æ³¨å†Œçš„åˆ†æå™¨ï¼ˆå¦‚æœå·²å­˜åœ¨è¯¥åˆ†æå™¨ï¼‰ã€‚åº”ç”¨å¯ä»¥åœ¨ç»‘å®šç”¨ä¾‹ä¹‹å‰æˆ–ä¹‹åéšæ—¶è®¾ç½®æ–°çš„åˆ†æå™¨ã€‚</p>
<h4 id="å°†-ImageAnalysis-ç»‘å®šåˆ°ç”Ÿå‘½å‘¨æœŸ"><a href="#å°†-ImageAnalysis-ç»‘å®šåˆ°ç”Ÿå‘½å‘¨æœŸ" class="headerlink" title="å°† ImageAnalysis ç»‘å®šåˆ°ç”Ÿå‘½å‘¨æœŸ"></a>å°† ImageAnalysis ç»‘å®šåˆ°ç”Ÿå‘½å‘¨æœŸ</h4><p><strong>æ³¨æ„</strong>ï¼šè¯¥æ­¥éª¤é€‚ç”¨äºæ‰€æœ‰ CameraX ç”¨ä¾‹ã€‚å¦‚éœ€è¯¦ç»†äº†è§£ç»‘å®šå’Œç”Ÿå‘½å‘¨æœŸè‡ªå®šä¹‰ï¼Œè¯·å‚é˜… <a target="_blank" rel="noopener" href="https://developer.android.google.cn/training/camerax/architecture?hl=zh-cn#api-model">CameraX API æ¨¡å‹</a>ã€‚</p>
<p>å¼ºçƒˆå»ºè®®æ‚¨ä½¿ç”¨ <a target="_blank" rel="noopener" href="https://developer.android.google.cn/reference/androidx/camera/lifecycle/ProcessCameraProvider#bindToLifecycle(androidx.lifecycle.LifecycleOwner,%20androidx.camera.core.CameraSelector,%20androidx.camera.core.UseCase...)"><code>ProcessCameraProvider.bindToLifecycle()</code></a> å‡½æ•°å°† <code>ImageAnalysis</code> ç»‘å®šåˆ°ç°æœ‰çš„ AndroidX ç”Ÿå‘½å‘¨æœŸã€‚è¯·æ³¨æ„ï¼Œ<code>bindToLifecycle()</code> å‡½æ•°ä¼šè¿”å›é€‰å®šçš„ <a target="_blank" rel="noopener" href="https://developer.android.google.cn/reference/androidx/camera/core/Camera?hl=zh-cn"><code>Camera</code></a> è®¾å¤‡ï¼Œè¯¥å‡½æ•°å¯ç”¨äºå¾®è°ƒæ›å…‰ç­‰é«˜çº§è®¾ç½®ã€‚å¦‚éœ€è¯¦ç»†äº†è§£å¦‚ä½•æ§åˆ¶ç›¸æœºè¾“å‡ºï¼Œè¯·å‚é˜…<a target="_blank" rel="noopener" href="https://developer.android.google.cn/training/camerax/configuration?hl=zh-cn#camera-output">æ­¤æŒ‡å—</a>ã€‚</p>
<p>ä»¥ä¸‹ç¤ºä¾‹ç»“åˆäº†ä¸Šè¿°æ­¥éª¤ä¸­çš„æ‰€æœ‰æ“ä½œï¼Œå°† CameraX <code>ImageAnalysis</code> å’Œ <code>Preview</code> ç”¨ä¾‹ç»‘å®šåˆ°äº† <code>lifeCycle</code> æ‰€æœ‰è€…ï¼š</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> imageAnalysis = ImageAnalysis.Builder()</span><br><span class="line">    <span class="comment">// enable the following line if RGBA output is needed.</span></span><br><span class="line">    <span class="comment">// .setOutputImageFormat(ImageAnalysis.OUTPUT_IMAGE_FORMAT_RGBA_8888)</span></span><br><span class="line">    .setTargetResolution(Size(<span class="number">1280</span>, <span class="number">720</span>))</span><br><span class="line">    .setBackpressureStrategy(ImageAnalysis.STRATEGY_KEEP_ONLY_LATEST)</span><br><span class="line">    .build()</span><br><span class="line">imageAnalysis.setAnalyzer(executor, ImageAnalysis.Analyzer &#123; imageProxy -&gt;</span><br><span class="line">    <span class="keyword">val</span> rotationDegrees = imageProxy.imageInfo.rotationDegrees</span><br><span class="line">    <span class="comment">// insert your code here.</span></span><br><span class="line">    ...</span><br><span class="line">    <span class="comment">// after done, release the ImageProxy object</span></span><br><span class="line">    imageProxy.close()</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">cameraProvider.bindToLifecycle(<span class="keyword">this</span> <span class="keyword">as</span> LifecycleOwner, cameraSelector, imageAnalysis, preview)</span><br></pre></td></tr></table></figure>

<h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><p><a target="_blank" rel="noopener" href="https://developer.android.google.cn/training/camerax">Android CameraX</a></p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>æ–‡ç« ä½œè€…: </span><span class="post-copyright-info"><a href="https://blog.lazyiones.top">LazyIonEs</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>æ–‡ç« é“¾æ¥: </span><span class="post-copyright-info"><a href="https://blog.lazyiones.top/post/ff52020d.html">https://blog.lazyiones.top/post/ff52020d.html</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>ç‰ˆæƒå£°æ˜: </span><span class="post-copyright-info">æœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> è®¸å¯åè®®ã€‚è½¬è½½è¯·æ³¨æ˜æ¥è‡ª <a href="https://blog.lazyiones.top" target="_blank">LazyIonEs</a>ï¼</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/Android/">Android</a><a class="post-meta__tags" href="/tags/CameraX/">CameraX</a><a class="post-meta__tags" href="/tags/Jetpack/">Jetpack</a><a class="post-meta__tags" href="/tags/%E7%9B%B8%E6%9C%BA/">ç›¸æœº</a></div><div class="post_share"><div class="social-share" data-image="/img/cover/img_cover_1.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/post/627b7883.html" title="Android CameraXä¸­ä½¿ç”¨Camera2"><img class="cover" src= "/img/loading.gif" data-lazy-src="/img/cover/img_cover_67.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">ä¸Šä¸€ç¯‡</div><div class="prev_info">Android CameraXä¸­ä½¿ç”¨Camera2</div></div></a></div><div class="next-post pull-right"><a href="/post/b3b8a43c.html" title="ä½¿ç”¨ sourceSets ç®¡ç†é£å‘³ç‰¹å®šçš„ AndroidManifest.xml"><img class="cover" src= "/img/loading.gif" data-lazy-src="/img/cover/img_cover_80.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">ä¸‹ä¸€ç¯‡</div><div class="next_info">ä½¿ç”¨ sourceSets ç®¡ç†é£å‘³ç‰¹å®šçš„ AndroidManifest.xml</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>ç›¸å…³æ¨è</span></div><div class="relatedPosts-list"><div><a href="/post/d8629189.html" title="Android CameraX CameraController"><img class="cover" src= "/img/loading.gif" data-lazy-src="/img/cover/img_cover_5.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-08-30</div><div class="title">Android CameraX CameraController</div></div></a></div><div><a href="/post/627b7883.html" title="Android CameraXä¸­ä½¿ç”¨Camera2"><img class="cover" src= "/img/loading.gif" data-lazy-src="/img/cover/img_cover_67.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-08-15</div><div class="title">Android CameraXä¸­ä½¿ç”¨Camera2</div></div></a></div><div><a href="/post/779b2eb0.html" title="ã€è‡ªå®šä¹‰ Viewã€‘ç›¸æœºé¢„è§ˆç‚¹å‡»èšç„¦æ¡†(å¸¦å¯¹ç„¦åŠ¨ç”»ï¼Œæ›å…‰è°ƒæ•´)"><img class="cover" src= "/img/loading.gif" data-lazy-src="/img/cover/img_cover_27.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-05-05</div><div class="title">ã€è‡ªå®šä¹‰ Viewã€‘ç›¸æœºé¢„è§ˆç‚¹å‡»èšç„¦æ¡†(å¸¦å¯¹ç„¦åŠ¨ç”»ï¼Œæ›å…‰è°ƒæ•´)</div></div></a></div><div><a href="/post/b3b8a43c.html" title="ä½¿ç”¨ sourceSets ç®¡ç†é£å‘³ç‰¹å®šçš„ AndroidManifest.xml"><img class="cover" src= "/img/loading.gif" data-lazy-src="/img/cover/img_cover_80.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-08-04</div><div class="title">ä½¿ç”¨ sourceSets ç®¡ç†é£å‘³ç‰¹å®šçš„ AndroidManifest.xml</div></div></a></div><div><a href="/post/7482f6f9.html" title="ä»¿å¢¨è¿¹24å°æ—¶å¤©æ°”è‡ªå®šä¹‰View"><img class="cover" src= "/img/loading.gif" data-lazy-src="/img/cover/img_cover_73.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-08-06</div><div class="title">ä»¿å¢¨è¿¹24å°æ—¶å¤©æ°”è‡ªå®šä¹‰View</div></div></a></div></div></div><hr class="custom-hr"/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> è¯„è®º</span></div></div><div class="comment-wrap"><div><div id="waline-wrap"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src= "/img/loading.gif" data-lazy-src="/img/avatar.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">LazyIonEs</div><div class="author-info__description">å­¦ä¹ Androidä¸¤å¹´åŠçš„Androidå¼€å‘å®ä¹ ç”Ÿ</div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">æ–‡ç« </div><div class="length-num">7</div></a><a href="/tags/"><div class="headline">æ ‡ç­¾</div><div class="length-num">12</div></a><a href="/categories/"><div class="headline">åˆ†ç±»</div><div class="length-num">10</div></a></div><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/lazyiones" target="_blank" title="Github"><i class="fab fa-github"></i></a><a class="social-icon" href="mailto:lazyiones@gmail.com" target="_blank" title="Email"><i class="fas fa-envelope"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>å…¬å‘Š</span></div><div class="announcement_content">å¦‚æœé˜…è¯»è¿‡ç¨‹ä¸­é‡åˆ°äº†é—®é¢˜ï¼Œè¯·åŠæ—¶è¯„è®ºæˆ–è€…ç•™è¨€ï¼Œçœ‹åˆ°äº†ä¼šåœ¨ç¬¬ä¸€æ—¶é—´ç»™å‡ºå›å¤ã€‚</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>ç›®å½•</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%89%8D%E8%A8%80"><span class="toc-number">1.</span> <span class="toc-text">å‰è¨€</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%A3%B0%E6%98%8E%E4%BE%9D%E8%B5%96%E9%A1%B9"><span class="toc-number">2.</span> <span class="toc-text">å£°æ˜ä¾èµ–é¡¹</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%9E%E7%8E%B0%E9%A2%84%E8%A7%88"><span class="toc-number">3.</span> <span class="toc-text">å®ç°é¢„è§ˆ</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B0%86-PreviewView-%E6%B7%BB%E5%8A%A0%E5%88%B0%E5%B8%83%E5%B1%80"><span class="toc-number">3.1.</span> <span class="toc-text">å°† PreviewView æ·»åŠ åˆ°å¸ƒå±€</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9D%E5%A7%8B%E5%8C%96%E7%9B%B8%E6%9C%BA"><span class="toc-number">3.2.</span> <span class="toc-text">åˆå§‹åŒ–ç›¸æœº</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A3%80%E6%9F%A5%E6%91%84%E5%83%8F%E5%A4%B4"><span class="toc-number">3.3.</span> <span class="toc-text">æ£€æŸ¥æ‘„åƒå¤´</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BB%91%E5%AE%9A%E7%9B%B8%E6%9C%BA"><span class="toc-number">3.4.</span> <span class="toc-text">ç»‘å®šç›¸æœº</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9B%BE%E7%89%87%E6%8B%8D%E6%91%84"><span class="toc-number">4.</span> <span class="toc-text">å›¾ç‰‡æ‹æ‘„</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%83%A8%E5%88%86%E5%8A%9F%E8%83%BD"><span class="toc-number">5.</span> <span class="toc-text">éƒ¨åˆ†åŠŸèƒ½</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%87%E6%8D%A2%E6%91%84%E5%83%8F%E5%A4%B4"><span class="toc-number">5.1.</span> <span class="toc-text">åˆ‡æ¢æ‘„åƒå¤´</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%89%8B%E7%94%B5%E7%AD%92"><span class="toc-number">5.2.</span> <span class="toc-text">æ‰‹ç”µç­’</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9B%9D%E5%85%89%E8%A1%A5%E5%81%BF"><span class="toc-number">5.3.</span> <span class="toc-text">æ›å…‰è¡¥å¿</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#PreviewView-%E7%9A%84%E5%85%B6%E4%BB%96API"><span class="toc-number">6.</span> <span class="toc-text">PreviewView çš„å…¶ä»–API</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%9E%E7%8E%B0%E6%A8%A1%E5%BC%8F"><span class="toc-number">6.1.</span> <span class="toc-text">å®ç°æ¨¡å¼</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BC%A9%E6%94%BE%E7%B1%BB%E5%9E%8B"><span class="toc-number">6.2.</span> <span class="toc-text">ç¼©æ”¾ç±»å‹</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE%E9%80%89%E9%A1%B9"><span class="toc-number">7.</span> <span class="toc-text">é…ç½®é€‰é¡¹</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#CameraXConfig"><span class="toc-number">7.1.</span> <span class="toc-text">CameraXConfig</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E6%A8%A1%E5%BC%8F"><span class="toc-number">7.1.1.</span> <span class="toc-text">ä½¿ç”¨æ¨¡å¼</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%91%84%E5%83%8F%E5%A4%B4%E9%99%90%E5%88%B6%E5%99%A8"><span class="toc-number">7.1.2.</span> <span class="toc-text">æ‘„åƒå¤´é™åˆ¶å™¨</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BA%BF%E7%A8%8B"><span class="toc-number">7.1.3.</span> <span class="toc-text">çº¿ç¨‹</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%91%84%E5%83%8F%E5%A4%B4%E6%89%A7%E8%A1%8C%E5%99%A8"><span class="toc-number">7.1.4.</span> <span class="toc-text">æ‘„åƒå¤´æ‰§è¡Œå™¨</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%B0%83%E5%BA%A6%E5%99%A8%E5%A4%84%E7%90%86%E7%A8%8B%E5%BA%8F"><span class="toc-number">7.1.5.</span> <span class="toc-text">è°ƒåº¦å™¨å¤„ç†ç¨‹åº</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%97%A5%E5%BF%97%E8%AE%B0%E5%BD%95"><span class="toc-number">7.1.6.</span> <span class="toc-text">æ—¥å¿—è®°å½•</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%87%AA%E5%8A%A8%E9%80%89%E6%8B%A9"><span class="toc-number">7.2.</span> <span class="toc-text">è‡ªåŠ¨é€‰æ‹©</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%97%8B%E8%BD%AC"><span class="toc-number">7.3.</span> <span class="toc-text">æ—‹è½¬</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%89%AA%E8%A3%81%E7%9F%A9%E5%BD%A2"><span class="toc-number">7.4.</span> <span class="toc-text">å‰ªè£çŸ©å½¢</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%91%84%E5%83%8F%E5%A4%B4%E5%88%86%E8%BE%A8%E7%8E%87"><span class="toc-number">7.5.</span> <span class="toc-text">æ‘„åƒå¤´åˆ†è¾¨ç‡</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%87%AA%E5%8A%A8%E5%88%86%E8%BE%A8%E7%8E%87"><span class="toc-number">7.5.1.</span> <span class="toc-text">è‡ªåŠ¨åˆ†è¾¨ç‡</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%8C%87%E5%AE%9A%E5%88%86%E8%BE%A8%E7%8E%87"><span class="toc-number">7.5.2.</span> <span class="toc-text">æŒ‡å®šåˆ†è¾¨ç‡</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8E%A7%E5%88%B6%E6%91%84%E5%83%8F%E5%A4%B4%E8%BE%93%E5%87%BA"><span class="toc-number">7.6.</span> <span class="toc-text">æ§åˆ¶æ‘„åƒå¤´è¾“å‡º</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96-CameraControl-%E5%92%8C-CameraInfo-%E7%9A%84%E5%AE%9E%E4%BE%8B"><span class="toc-number">7.6.1.</span> <span class="toc-text">è·å– CameraControl å’Œ CameraInfo çš„å®ä¾‹</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AF%B9%E7%84%A6%E5%92%8C%E6%B5%8B%E5%85%89"><span class="toc-number">7.6.2.</span> <span class="toc-text">å¯¹ç„¦å’Œæµ‹å…‰</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9B%BE%E5%83%8F%E5%88%86%E6%9E%90"><span class="toc-number">8.</span> <span class="toc-text">å›¾åƒåˆ†æ</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%93%8D%E4%BD%9C%E6%A8%A1%E5%BC%8F"><span class="toc-number">8.1.</span> <span class="toc-text">æ“ä½œæ¨¡å¼</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%9E%E7%8E%B0"><span class="toc-number">8.2.</span> <span class="toc-text">å®ç°</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9E%84%E5%BB%BA-ImageAnalysis-%E7%94%A8%E4%BE%8B"><span class="toc-number">8.2.1.</span> <span class="toc-text">æ„å»º ImageAnalysis ç”¨ä¾‹</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E5%88%86%E6%9E%90%E5%99%A8"><span class="toc-number">8.2.2.</span> <span class="toc-text">åˆ›å»ºåˆ†æå™¨</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%92%88%E5%AF%B9-ImageAnalysis-%E9%85%8D%E7%BD%AE%E5%88%86%E6%9E%90%E5%99%A8"><span class="toc-number">8.2.3.</span> <span class="toc-text">é’ˆå¯¹ ImageAnalysis é…ç½®åˆ†æå™¨</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B0%86-ImageAnalysis-%E7%BB%91%E5%AE%9A%E5%88%B0%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F"><span class="toc-number">8.2.4.</span> <span class="toc-text">å°† ImageAnalysis ç»‘å®šåˆ°ç”Ÿå‘½å‘¨æœŸ</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%82%E8%80%83"><span class="toc-number">9.</span> <span class="toc-text">å‚è€ƒ</span></a></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>æœ€æ–°æ–‡ç« </span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/post/d8629189.html" title="Android CameraX CameraController"><img src= "/img/loading.gif" data-lazy-src="/img/cover/img_cover_5.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Android CameraX CameraController"/></a><div class="content"><a class="title" href="/post/d8629189.html" title="Android CameraX CameraController">Android CameraX CameraController</a><time datetime="2023-08-30T11:14:58.000Z" title="å‘è¡¨äº 2023-08-30 19:14:58">2023-08-30</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/post/c054934f.html" title="HomeBrew å¸¸ç”¨æŒ‡ä»¤"><img src= "/img/loading.gif" data-lazy-src="/img/cover/img_cover_51.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="HomeBrew å¸¸ç”¨æŒ‡ä»¤"/></a><div class="content"><a class="title" href="/post/c054934f.html" title="HomeBrew å¸¸ç”¨æŒ‡ä»¤">HomeBrew å¸¸ç”¨æŒ‡ä»¤</a><time datetime="2023-08-30T10:50:42.000Z" title="å‘è¡¨äº 2023-08-30 18:50:42">2023-08-30</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/post/627b7883.html" title="Android CameraXä¸­ä½¿ç”¨Camera2"><img src= "/img/loading.gif" data-lazy-src="/img/cover/img_cover_67.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Android CameraXä¸­ä½¿ç”¨Camera2"/></a><div class="content"><a class="title" href="/post/627b7883.html" title="Android CameraXä¸­ä½¿ç”¨Camera2">Android CameraXä¸­ä½¿ç”¨Camera2</a><time datetime="2023-08-15T01:39:50.000Z" title="å‘è¡¨äº 2023-08-15 09:39:50">2023-08-15</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/post/ff52020d.html" title="Android CameraXçš„åŸºæœ¬ä½¿ç”¨"><img src= "/img/loading.gif" data-lazy-src="/img/cover/img_cover_1.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Android CameraXçš„åŸºæœ¬ä½¿ç”¨"/></a><div class="content"><a class="title" href="/post/ff52020d.html" title="Android CameraXçš„åŸºæœ¬ä½¿ç”¨">Android CameraXçš„åŸºæœ¬ä½¿ç”¨</a><time datetime="2023-08-14T11:31:06.000Z" title="å‘è¡¨äº 2023-08-14 19:31:06">2023-08-14</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/post/b3b8a43c.html" title="ä½¿ç”¨ sourceSets ç®¡ç†é£å‘³ç‰¹å®šçš„ AndroidManifest.xml"><img src= "/img/loading.gif" data-lazy-src="/img/cover/img_cover_80.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="ä½¿ç”¨ sourceSets ç®¡ç†é£å‘³ç‰¹å®šçš„ AndroidManifest.xml"/></a><div class="content"><a class="title" href="/post/b3b8a43c.html" title="ä½¿ç”¨ sourceSets ç®¡ç†é£å‘³ç‰¹å®šçš„ AndroidManifest.xml">ä½¿ç”¨ sourceSets ç®¡ç†é£å‘³ç‰¹å®šçš„ AndroidManifest.xml</a><time datetime="2023-08-04T03:57:22.000Z" title="å‘è¡¨äº 2023-08-04 11:57:22">2023-08-04</time></div></div></div></div></div></div></main><footer id="footer" style="background: url(/img/footer_bg.png)"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2023 By LazyIonEs</div><div class="framework-info"><span>æ¡†æ¶ </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>ä¸»é¢˜ </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="é˜…è¯»æ¨¡å¼"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="æµ…è‰²å’Œæ·±è‰²æ¨¡å¼è½¬æ¢"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="å•æ å’ŒåŒæ åˆ‡æ¢"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="è®¾ç½®"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="ç›®å½•"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="ç›´è¾¾è¯„è®º"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="å›åˆ°é¡¶éƒ¨"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/medium-zoom/dist/medium-zoom.min.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page/instantpage.min.js" type="module"></script><script src="https://cdn.jsdelivr.net/npm/vanilla-lazyload/dist/lazyload.iife.min.js"></script><div class="js-pjax"><script>(() => {
  const initWaline = () => {
    const waline = Waline.init(Object.assign({
      el: '#waline-wrap',
      serverURL: 'https://waline.lazyiones.top',
      pageview: false,
      dark: 'html[data-theme="dark"]',
      path: window.location.pathname,
      comment: true,
    }, null))
  }

  const loadWaline = async () => {
    if (typeof Waline === 'object') initWaline()
    else {
      await getCSS('https://cdn.jsdelivr.net/npm/@waline/client/dist/waline.min.css')
      await getScript('https://cdn.jsdelivr.net/npm/@waline/client/dist/waline.min.js')
      initWaline()
    }
  }

  if ('Waline' === 'Waline' || !false) {
    if (false) btf.loadComment(document.getElementById('waline-wrap'),loadWaline)
    else setTimeout(loadWaline, 0)
  } else {
    window.loadOtherComment = loadWaline
  }
})()</script></div><script async src="https://npm.elemecdn.com/tzy-blog/lib/js/other/sakura.js"></script><script id="canvas_nest" defer="defer" color="42,81,144" opacity="1" zIndex="-1" count="99" mobile="false" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/canvas-nest.min.js"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">æœç´¢</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  æ•°æ®åº“åŠ è½½ä¸­</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="æœç´¢æ–‡ç« " type="text"/></div></div><hr/><div id="local-search-results"></div><div id="local-search-stats-wrap"></div></div></div><div id="search-mask"></div><script src="/js/search/local-search.js"></script></div></div></body></html>